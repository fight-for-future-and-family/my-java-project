<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hoolai.bi.report.model.entity.UserRetentionSourceLtv" >
   <resultMap id="BaseResultMap" type="com.hoolai.bi.report.model.entity.UserRetentionSourceLtv" >
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="snid" property="snid" jdbcType="VARCHAR" />
    <result column="gameid" property="gameid" jdbcType="VARCHAR" />
    <result column="source" property="source" jdbcType="VARCHAR" />
    <result column="install_day" property="installDay" jdbcType="VARCHAR" />
    <result column="stat_day" property="statDay" jdbcType="VARCHAR" />
    <result column="install" property="install" jdbcType="INTEGER" />
    <result column="retention_day" property="retentionDay" jdbcType="INTEGER" />
    <result column="retention_rate" property="retentionRate" jdbcType="DOUBLE" />
    <result column="retention_num" property="retentionNum" jdbcType="INTEGER" />
    <result column="total_amount" property="totalAmount" jdbcType="DOUBLE" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
  </resultMap>
  <sql id="Base_Column_List" >
    id, snid, gameid, source, install_day, stat_day, install, retention_day, retention_rate, 
    retention_num, total_amount, create_time
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    select 
    <include refid="Base_Column_List" />
    from user_retention_source_ltv
    where id = #{id,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    delete from user_retention_source_ltv
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.hoolai.bi.report.model.entity.UserRetentionSourceLtv" >
    insert into user_retention_source_ltv (id, snid, gameid, 
      source, install_day, stat_day, 
      install, retention_day, retention_rate, 
      retention_num, total_amount, create_time
      )
    values (#{id,jdbcType=BIGINT}, #{snid,jdbcType=VARCHAR}, #{gameid,jdbcType=VARCHAR}, 
      #{source,jdbcType=VARCHAR}, #{installDay,jdbcType=VARCHAR}, #{statDay,jdbcType=VARCHAR}, 
      #{install,jdbcType=INTEGER}, #{retentionDay,jdbcType=INTEGER}, #{retentionRate,jdbcType=DOUBLE}, 
      #{retentionNum,jdbcType=INTEGER}, #{totalAmount,jdbcType=DOUBLE}, #{createTime,jdbcType=TIMESTAMP}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.hoolai.bi.report.model.entity.UserRetentionSourceLtv" >
    insert into user_retention_source_ltv
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="snid != null" >
        snid,
      </if>
      <if test="gameid != null" >
        gameid,
      </if>
      <if test="source != null" >
        source,
      </if>
      <if test="installDay != null" >
        install_day,
      </if>
      <if test="statDay != null" >
        stat_day,
      </if>
      <if test="install != null" >
        install,
      </if>
      <if test="retentionDay != null" >
        retention_day,
      </if>
      <if test="retentionRate != null" >
        retention_rate,
      </if>
      <if test="retentionNum != null" >
        retention_num,
      </if>
      <if test="totalAmount != null" >
        total_amount,
      </if>
      <if test="createTime != null" >
        create_time,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=BIGINT},
      </if>
      <if test="snid != null" >
        #{snid,jdbcType=VARCHAR},
      </if>
      <if test="gameid != null" >
        #{gameid,jdbcType=VARCHAR},
      </if>
      <if test="source != null" >
        #{source,jdbcType=VARCHAR},
      </if>
      <if test="installDay != null" >
        #{installDay,jdbcType=VARCHAR},
      </if>
      <if test="statDay != null" >
        #{statDay,jdbcType=VARCHAR},
      </if>
      <if test="install != null" >
        #{install,jdbcType=INTEGER},
      </if>
      <if test="retentionDay != null" >
        #{retentionDay,jdbcType=INTEGER},
      </if>
      <if test="retentionRate != null" >
        #{retentionRate,jdbcType=DOUBLE},
      </if>
      <if test="retentionNum != null" >
        #{retentionNum,jdbcType=INTEGER},
      </if>
      <if test="totalAmount != null" >
        #{totalAmount,jdbcType=DOUBLE},
      </if>
      <if test="createTime != null" >
        #{createTime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.hoolai.bi.report.model.entity.UserRetentionSourceLtv" >
    update user_retention_source_ltv
    <set >
      <if test="snid != null" >
        snid = #{snid,jdbcType=VARCHAR},
      </if>
      <if test="gameid != null" >
        gameid = #{gameid,jdbcType=VARCHAR},
      </if>
      <if test="source != null" >
        source = #{source,jdbcType=VARCHAR},
      </if>
      <if test="installDay != null" >
        install_day = #{installDay,jdbcType=VARCHAR},
      </if>
      <if test="statDay != null" >
        stat_day = #{statDay,jdbcType=VARCHAR},
      </if>
      <if test="install != null" >
        install = #{install,jdbcType=INTEGER},
      </if>
      <if test="retentionDay != null" >
        retention_day = #{retentionDay,jdbcType=INTEGER},
      </if>
      <if test="retentionRate != null" >
        retention_rate = #{retentionRate,jdbcType=DOUBLE},
      </if>
      <if test="retentionNum != null" >
        retention_num = #{retentionNum,jdbcType=INTEGER},
      </if>
      <if test="totalAmount != null" >
        total_amount = #{totalAmount,jdbcType=DOUBLE},
      </if>
      <if test="createTime != null" >
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.hoolai.bi.report.model.entity.UserRetentionSourceLtv" >
    update user_retention_source_ltv
    set snid = #{snid,jdbcType=VARCHAR},
      gameid = #{gameid,jdbcType=VARCHAR},
      source = #{source,jdbcType=VARCHAR},
      install_day = #{installDay,jdbcType=VARCHAR},
      stat_day = #{statDay,jdbcType=VARCHAR},
      install = #{install,jdbcType=INTEGER},
      retention_day = #{retentionDay,jdbcType=INTEGER},
      retention_rate = #{retentionRate,jdbcType=DOUBLE},
      retention_num = #{retentionNum,jdbcType=INTEGER},
      total_amount = #{totalAmount,jdbcType=DOUBLE},
      create_time = #{createTime,jdbcType=TIMESTAMP}
    where id = #{id,jdbcType=BIGINT}
  </update>
  
  <sql id="Vo_Where_Clause">
		<where>
			<if test="entity!=null">
				<if test="entity.id != null ">
					 <![CDATA[  and id = #{entity.id} ]]>
				</if>
				<if test="entity.snid != null and entity.snid != ''">
					 <![CDATA[  and snid = #{entity.snid} ]]>
				</if>
				<if test="entity.gameid != null and entity.gameid != ''">
					 <![CDATA[  and gameid = #{entity.gameid} ]]>
				</if>
				<if test="entity.source != null and entity.source != ''">
					 <![CDATA[  and source = #{entity.source} ]]>
				</if>
				<if test="beginDate != null">
					 <![CDATA[  and install_day >= #{beginDate} ]]>
				</if>
				<if test="endDate != null">
					 <![CDATA[  and install_day <= #{endDate} ]]>
				</if>
				
			</if>
		</where>
	</sql>
	
	<sql id="Vo_Where_Clause_daily_report">
		<where>
			<if test="entity!=null">
				<if test="entity.id != null ">
					 <![CDATA[ and id = #{entity.id} ]]>
				</if>
				<if test="entity.snid != null and entity.snid != ''">
					 <![CDATA[ and snid = #{entity.snid} ]]>
				</if>
				<if test="entity.gameid != null and entity.gameid != ''">
					 <![CDATA[ and gameid = #{entity.gameid} ]]>
				</if>
				<if test="entity.source != null and entity.source != ''">
					 <![CDATA[ and source = #{entity.source} ]]>
				</if>
				<if test="beginDate != null">
					 <![CDATA[ and day >= #{beginDate} ]]>
				</if>
				<if test="endDate != null">
					 <![CDATA[ and day <= #{endDate} ]]>
				</if>
				
			</if>
		</where>
	</sql>
	
	<select id="selectMatchList" parameterType="com.hoolai.bi.report.vo.UserRetentionSourceLtvVO" resultMap="BaseResultMap">
     select 
     <include refid="Base_Column_List" />
     from user_retention_source_ltv
     <if test="_parameter != null">
			<include refid="Vo_Where_Clause" />
		</if>
  </select>
  
  <resultMap id="barResultMap" type="com.hoolai.bi.report.vo.UserRetentionSourceLtvVO" >
       <result column="source" property="entity.source" jdbcType="VARCHAR" />
       <result column="retention_day" property="entity.retentionDay" jdbcType="INTEGER" />
       <result column="install_day" property="entity.installDay" jdbcType="VARCHAR" />
       <result column="avg_ltv" property="avgLtv" jdbcType="DOUBLE" />
       <result column="avg_retention_rate" property="avgRetentionRate" jdbcType="DOUBLE" />
    </resultMap>

	<select id="selectPaymentForBarList" parameterType="com.hoolai.bi.report.vo.UserRetentionSourceLtvVO" resultMap="barResultMap">
		select b.source,b.retention_day,avg(b.total_amount/b.install) as
		avg_ltv from
		(
		select * from user_retention_source_ltv
		<if test="_parameter != null">
			<include refid="Vo_Where_Clause" />
				<![CDATA[ and (retention_day = 0 or retention_day = 1 or retention_day = 3 or retention_day = 7 or retention_day = 30) ]]>
		</if>
		)b
		left outer join
		(
		select snid,gameid,source,sum(total_amount) as total_amount
		from
		(select snid,gameid,source,install_day,max(total_amount) as total_amount
		,max(retention_day) as rentention_day from
		user_retention_source_ltv
		<if test="_parameter != null">
			<include refid="Vo_Where_Clause" />
				<![CDATA[ and (retention_day = 0 or retention_day = 1 or retention_day = 3 or retention_day = 7 or retention_day = 30) ]]>
		</if>
		group by snid,gameid,source,install_day )tmp
		group by snid,gameid,source
		order by total_amount desc
		limit 5
		)a on a.snid =b.snid and a.gameid=b.gameid and a.source = b.source
		where a.snid is not null
		group by b.source,b.retention_day
    </select>
	
	<select id="selectAvgInstallLTVDataList" parameterType="com.hoolai.bi.report.vo.UserRetentionSourceLtvVO" resultMap="barResultMap">
		select b.retention_day,avg(b.total_amount/b.install) as avg_ltv
		from
		  (select * from user_retention_source_ltv
	      <if test="_parameter != null">
			<include refid="Vo_Where_Clause" />
			<![CDATA[ and ((retention_day >= 0 and retention_day <= 7) or 
			retention_day = 14 or retention_day = 21 or retention_day = 30) ]]>
		</if>
		  )b
		group by b.retention_day
	    order by b.retention_day
	</select>
	
	<select id="selectAvgInstallRetentionDataList" parameterType="com.hoolai.bi.report.vo.UserRetentionSourceLtvVO" resultMap="barResultMap">
		select b.retention_day,avg(b.retention_rate) as avg_retention_rate
		from
		  (select * from user_retention_source_ltv
	      <if test="_parameter != null">
			<include refid="Vo_Where_Clause" />
			<![CDATA[ and ((retention_day >= 0 and retention_day <= 7) or 
			retention_day = 14 or retention_day = 21 or retention_day = 30) ]]>
		</if>
		  )b
		group by b.retention_day
	    order by b.retention_day
	</select>
	
	<select id="selectAvgRoleRetentionDataList" parameterType="com.hoolai.bi.report.vo.UserRetentionSourceLtvVO" resultMap="barResultMap">
		select a.retention_day,avg(a.retention_num / b.role_choice) as avg_retention_rate
		from
		  (select * from user_retention_source_ltv
	      <if test="_parameter != null">
			<include refid="Vo_Where_Clause" />
			<![CDATA[ and ((retention_day >= 0 and retention_day <= 7) or 
			retention_day = 14 or retention_day = 21 or retention_day = 30) ]]>
		</if>
		  )a
		  left outer join
      (
	     select day,role_choice
	     from source_daily_report 
         <if test="_parameter != null">
		   <include refid="Vo_Where_Clause_daily_report" />
	    </if>
       ) b on a.install_day = b.day
		group by a.retention_day
	    order by a.retention_day
	</select>
	
	<select id="selectAvgRoleChioceLTVDataList" parameterType="com.hoolai.bi.report.vo.UserRetentionSourceLtvVO" resultMap="barResultMap">
		select b.retention_day,avg(b.total_amount/c.role_choice) as avg_ltv
		from
		  (select * from user_retention_source_ltv
	      <if test="_parameter != null">
			<include refid="Vo_Where_Clause" />
			<![CDATA[ and ((retention_day >= 0 and retention_day <= 7) or 
			retention_day = 14 or retention_day = 21 or retention_day = 30) ]]>
		</if>
		  )b
	   	left outer join
	  	(select snid,gameid,day,role_choice from source_daily_report
		   <if test="_parameter != null">
			<include refid="Vo_Where_Clause_daily_report" />
		</if>
	 	) c on b.snid =c.snid and b.gameid=c.gameid and b.install_day = c.day
		group by b.retention_day
	    order by b.retention_day
	</select>
  
  <resultMap id="LifeResultMap" type="com.hoolai.bi.report.vo.UserRetentionSourceLtvVO" >
       <result column="install_day" property="gameLtv.installDay" jdbcType="VARCHAR" />
       <result column="install" property="gameLtv.install" jdbcType="INTEGER" />
       <result column="retention_rate" property="gameLtv.retentionRate" jdbcType="DOUBLE" />
       <result column="source" property="gameLtv.sourceOrClientName" jdbcType="VARCHAR" />
       <result column="D0" property="gameLtv.d0" jdbcType="DOUBLE" />
       <result column="D1" property="gameLtv.d1" jdbcType="DOUBLE" />
       <result column="D2" property="gameLtv.d2" jdbcType="DOUBLE" />
       <result column="D3" property="gameLtv.d3" jdbcType="DOUBLE" />
       <result column="D4" property="gameLtv.d4" jdbcType="DOUBLE" />
       <result column="D5" property="gameLtv.d5" jdbcType="DOUBLE" />
       <result column="D6" property="gameLtv.d6" jdbcType="DOUBLE" />
       <result column="D7" property="gameLtv.d7" jdbcType="DOUBLE" />
       <result column="D8" property="gameLtv.d8" jdbcType="DOUBLE" />
       <result column="D9" property="gameLtv.d9" jdbcType="DOUBLE" />
       <result column="D10" property="gameLtv.d10" jdbcType="DOUBLE" />
       <result column="D11" property="gameLtv.d11" jdbcType="DOUBLE" />
       <result column="D12" property="gameLtv.d12" jdbcType="DOUBLE" />
       <result column="D13" property="gameLtv.d13" jdbcType="DOUBLE" />
       <result column="D14" property="gameLtv.d14" jdbcType="DOUBLE" />
       <result column="D15" property="gameLtv.d15" jdbcType="DOUBLE" />
       <result column="D16" property="gameLtv.d16" jdbcType="DOUBLE" />
       <result column="D17" property="gameLtv.d17" jdbcType="DOUBLE" />
       <result column="D18" property="gameLtv.d18" jdbcType="DOUBLE" />
       <result column="D19" property="gameLtv.d19" jdbcType="DOUBLE" />
       <result column="D20" property="gameLtv.d20" jdbcType="DOUBLE" />
       <result column="D21" property="gameLtv.d21" jdbcType="DOUBLE" />
       <result column="D22" property="gameLtv.d22" jdbcType="DOUBLE" />
       <result column="D23" property="gameLtv.d23" jdbcType="DOUBLE" />
       <result column="D24" property="gameLtv.d24" jdbcType="DOUBLE" />
       <result column="D25" property="gameLtv.d25" jdbcType="DOUBLE" />
       <result column="D26" property="gameLtv.d26" jdbcType="DOUBLE" />
       <result column="D27" property="gameLtv.d27" jdbcType="DOUBLE" />
       <result column="D28" property="gameLtv.d28" jdbcType="DOUBLE" />
       <result column="D29" property="gameLtv.d29" jdbcType="DOUBLE" />
       <result column="D30" property="gameLtv.d30" jdbcType="DOUBLE" />
       <result column="D31" property="gameLtv.d31" jdbcType="DOUBLE" />
       <result column="D32" property="gameLtv.d32" jdbcType="DOUBLE" />
       <result column="D33" property="gameLtv.d33" jdbcType="DOUBLE" />
       <result column="D34" property="gameLtv.d34" jdbcType="DOUBLE" />
       <result column="D35" property="gameLtv.d35" jdbcType="DOUBLE" />
       <result column="D36" property="gameLtv.d36" jdbcType="DOUBLE" />
       <result column="D37" property="gameLtv.d37" jdbcType="DOUBLE" />
       <result column="D38" property="gameLtv.d38" jdbcType="DOUBLE" />
       <result column="D39" property="gameLtv.d39" jdbcType="DOUBLE" />
       <result column="D40" property="gameLtv.d40" jdbcType="DOUBLE" />
       <result column="D41" property="gameLtv.d41" jdbcType="DOUBLE" />
       <result column="D42" property="gameLtv.d42" jdbcType="DOUBLE" />
       <result column="D43" property="gameLtv.d43" jdbcType="DOUBLE" />
       <result column="D44" property="gameLtv.d44" jdbcType="DOUBLE" />
       <result column="D45" property="gameLtv.d45" jdbcType="DOUBLE" />
       <result column="D46" property="gameLtv.d46" jdbcType="DOUBLE" />
       <result column="D47" property="gameLtv.d47" jdbcType="DOUBLE" />
       <result column="D48" property="gameLtv.d48" jdbcType="DOUBLE" />
       <result column="D49" property="gameLtv.d49" jdbcType="DOUBLE" />
       <result column="D50" property="gameLtv.d50" jdbcType="DOUBLE" />
       <result column="D51" property="gameLtv.d51" jdbcType="DOUBLE" />
       <result column="D52" property="gameLtv.d52" jdbcType="DOUBLE" />
       <result column="D53" property="gameLtv.d53" jdbcType="DOUBLE" />
       <result column="D54" property="gameLtv.d54" jdbcType="DOUBLE" />
       <result column="D55" property="gameLtv.d55" jdbcType="DOUBLE" />
       <result column="D56" property="gameLtv.d56" jdbcType="DOUBLE" />
       <result column="D57" property="gameLtv.d57" jdbcType="DOUBLE" />
       <result column="D58" property="gameLtv.d58" jdbcType="DOUBLE" />
       <result column="D59" property="gameLtv.d59" jdbcType="DOUBLE" />
       <result column="D60" property="gameLtv.d60" jdbcType="DOUBLE" />
       <result column="D61" property="gameLtv.d61" jdbcType="DOUBLE" />
       <result column="D62" property="gameLtv.d62" jdbcType="DOUBLE" />
       <result column="D63" property="gameLtv.d63" jdbcType="DOUBLE" />
       <result column="D64" property="gameLtv.d64" jdbcType="DOUBLE" />
       <result column="D65" property="gameLtv.d65" jdbcType="DOUBLE" />
       <result column="D66" property="gameLtv.d66" jdbcType="DOUBLE" />
       <result column="D67" property="gameLtv.d67" jdbcType="DOUBLE" />
       <result column="D68" property="gameLtv.d68" jdbcType="DOUBLE" />
       <result column="D69" property="gameLtv.d69" jdbcType="DOUBLE" />
       <result column="D70" property="gameLtv.d70" jdbcType="DOUBLE" />
       <result column="D71" property="gameLtv.d71" jdbcType="DOUBLE" />
       <result column="D72" property="gameLtv.d72" jdbcType="DOUBLE" />
       <result column="D73" property="gameLtv.d73" jdbcType="DOUBLE" />
       <result column="D74" property="gameLtv.d74" jdbcType="DOUBLE" />
       <result column="D75" property="gameLtv.d75" jdbcType="DOUBLE" />
       <result column="D76" property="gameLtv.d76" jdbcType="DOUBLE" />
       <result column="D77" property="gameLtv.d77" jdbcType="DOUBLE" />
       <result column="D78" property="gameLtv.d78" jdbcType="DOUBLE" />
       <result column="D79" property="gameLtv.d79" jdbcType="DOUBLE" />
       <result column="D80" property="gameLtv.d80" jdbcType="DOUBLE" />
       <result column="D81" property="gameLtv.d81" jdbcType="DOUBLE" />
       <result column="D82" property="gameLtv.d82" jdbcType="DOUBLE" />
       <result column="D83" property="gameLtv.d83" jdbcType="DOUBLE" />
       <result column="D84" property="gameLtv.d84" jdbcType="DOUBLE" />
       <result column="D85" property="gameLtv.d85" jdbcType="DOUBLE" />
       <result column="D86" property="gameLtv.d86" jdbcType="DOUBLE" />
       <result column="D87" property="gameLtv.d87" jdbcType="DOUBLE" />
       <result column="D88" property="gameLtv.d88" jdbcType="DOUBLE" />
       <result column="D89" property="gameLtv.d89" jdbcType="DOUBLE" />
       <result column="D90" property="gameLtv.d90" jdbcType="DOUBLE" />
    </resultMap>
    
    <select id="selectHorizontal4InstallRetentionRateList" parameterType="com.hoolai.bi.report.vo.UserRetentionLtvVO" resultMap="LifeResultMap">
		select install_day,max(install) install,
		max(case retention_day when 0 then retention_rate else 0 end) D0,
		max(case retention_day when 1 then retention_rate else 0 end) D1,
		max(case retention_day when 2 then retention_rate else 0 end) D2,
		max(case retention_day when 3 then retention_rate else 0 end) D3,
		max(case retention_day when 4 then retention_rate else 0 end) D4,
		max(case retention_day when 5 then retention_rate else 0 end) D5,
		max(case retention_day when 6 then retention_rate else 0 end) D6,
		max(case retention_day when 7 then retention_rate else 0 end) D7,
		max(case retention_day when 8 then retention_rate else 0 end) D8,
		max(case retention_day when 9 then retention_rate else 0 end) D9,
		max(case retention_day when 10 then retention_rate else 0 end) D10,
		max(case retention_day when 11 then retention_rate else 0 end) D11,
		max(case retention_day when 12 then retention_rate else 0 end) D12,
		max(case retention_day when 13 then retention_rate else 0 end) D13,
		max(case retention_day when 14 then retention_rate else 0 end) D14,
		max(case retention_day when 15 then retention_rate else 0 end) D15,
		max(case retention_day when 16 then retention_rate else 0 end) D16,
		max(case retention_day when 17 then retention_rate else 0 end) D17,
		max(case retention_day when 18 then retention_rate else 0 end) D18,
		max(case retention_day when 19 then retention_rate else 0 end) D19,
		max(case retention_day when 20 then retention_rate else 0 end) D20,
		max(case retention_day when 21 then retention_rate else 0 end) D21,
		max(case retention_day when 22 then retention_rate else 0 end) D22,
		max(case retention_day when 23 then retention_rate else 0 end) D23,
		max(case retention_day when 24 then retention_rate else 0 end) D24,
		max(case retention_day when 25 then retention_rate else 0 end) D25,
		max(case retention_day when 26 then retention_rate else 0 end) D26,
		max(case retention_day when 27 then retention_rate else 0 end) D27,
		max(case retention_day when 28 then retention_rate else 0 end) D28,
		max(case retention_day when 29 then retention_rate else 0 end) D29,
		max(case retention_day when 30 then retention_rate else 0 end) D30,
		max(case retention_day when 31 then retention_rate else 0 end) D31,
		max(case retention_day when 32 then retention_rate else 0 end) D32,
		max(case retention_day when 33 then retention_rate else 0 end) D33,
		max(case retention_day when 34 then retention_rate else 0 end) D34,
		max(case retention_day when 35 then retention_rate else 0 end) D35,
		max(case retention_day when 36 then retention_rate else 0 end) D36,
		max(case retention_day when 37 then retention_rate else 0 end) D37,
		max(case retention_day when 38 then retention_rate else 0 end) D38,
		max(case retention_day when 39 then retention_rate else 0 end) D39,
		max(case retention_day when 40 then retention_rate else 0 end) D40,
		max(case retention_day when 41 then retention_rate else 0 end) D41,
		max(case retention_day when 42 then retention_rate else 0 end) D42,
		max(case retention_day when 43 then retention_rate else 0 end) D43,
		max(case retention_day when 44 then retention_rate else 0 end) D44,
		max(case retention_day when 45 then retention_rate else 0 end) D45,
		max(case retention_day when 46 then retention_rate else 0 end) D46,
		max(case retention_day when 47 then retention_rate else 0 end) D47,
		max(case retention_day when 48 then retention_rate else 0 end) D48,
		max(case retention_day when 49 then retention_rate else 0 end) D49,
		max(case retention_day when 50 then retention_rate else 0 end) D50,
		max(case retention_day when 51 then retention_rate else 0 end) D51,
		max(case retention_day when 52 then retention_rate else 0 end) D52,
		max(case retention_day when 53 then retention_rate else 0 end) D53,
		max(case retention_day when 54 then retention_rate else 0 end) D54,
		max(case retention_day when 55 then retention_rate else 0 end) D55,
		max(case retention_day when 56 then retention_rate else 0 end) D56,
		max(case retention_day when 57 then retention_rate else 0 end) D57,
		max(case retention_day when 58 then retention_rate else 0 end) D58,
		max(case retention_day when 59 then retention_rate else 0 end) D59,
		max(case retention_day when 60 then retention_rate else 0 end) D60,
		max(case retention_day when 61 then retention_rate else 0 end) D61,
		max(case retention_day when 62 then retention_rate else 0 end) D62,
		max(case retention_day when 63 then retention_rate else 0 end) D63,
		max(case retention_day when 64 then retention_rate else 0 end) D64,
		max(case retention_day when 65 then retention_rate else 0 end) D65,
		max(case retention_day when 66 then retention_rate else 0 end) D66,
		max(case retention_day when 67 then retention_rate else 0 end) D67,
		max(case retention_day when 68 then retention_rate else 0 end) D68,
		max(case retention_day when 69 then retention_rate else 0 end) D69,
		max(case retention_day when 70 then retention_rate else 0 end) D70,
		max(case retention_day when 71 then retention_rate else 0 end) D71,
		max(case retention_day when 72 then retention_rate else 0 end) D72,
		max(case retention_day when 73 then retention_rate else 0 end) D73,
		max(case retention_day when 74 then retention_rate else 0 end) D74,
		max(case retention_day when 75 then retention_rate else 0 end) D75,
		max(case retention_day when 76 then retention_rate else 0 end) D76,
		max(case retention_day when 77 then retention_rate else 0 end) D77,
		max(case retention_day when 78 then retention_rate else 0 end) D78,
		max(case retention_day when 79 then retention_rate else 0 end) D79,
		max(case retention_day when 80 then retention_rate else 0 end) D80,
		max(case retention_day when 81 then retention_rate else 0 end) D81,
		max(case retention_day when 82 then retention_rate else 0 end) D82,
		max(case retention_day when 83 then retention_rate else 0 end) D83,
		max(case retention_day when 84 then retention_rate else 0 end) D84,
		max(case retention_day when 85 then retention_rate else 0 end) D85,
		max(case retention_day when 86 then retention_rate else 0 end) D86,
		max(case retention_day when 87 then retention_rate else 0 end) D87,
		max(case retention_day when 88 then retention_rate else 0 end) D88,
		max(case retention_day when 89 then retention_rate else 0 end) D89,
		max(case retention_day when 90 then retention_rate else 0 end) D90
		from user_retention_source_ltv 
		<if test="_parameter != null">
			<include refid="Vo_Where_Clause" />
			<![CDATA[ 
				and (retention_day >= 0 and retention_day <= 90) 
				group by install_day
			]]>
		</if>
</select>


<select id="selectHorizontal4RoleRetentionRateList" parameterType="com.hoolai.bi.report.vo.UserRetentionLtvVO" resultMap="LifeResultMap">
	
	select a.install_day,b.role_choice as install,
		max(case a.retention_day when 0 then (a.retention_num / b.role_choice) else 0 end) D0,
		max(case a.retention_day when 1 then (a.retention_num / b.role_choice) else 0 end) D1,
		max(case a.retention_day when 2 then (a.retention_num / b.role_choice) else 0 end) D2,
		max(case a.retention_day when 3 then (a.retention_num / b.role_choice) else 0 end) D3,
		max(case a.retention_day when 4 then (a.retention_num / b.role_choice) else 0 end) D4,
		max(case a.retention_day when 5 then (a.retention_num / b.role_choice) else 0 end) D5,
		max(case a.retention_day when 6 then (a.retention_num / b.role_choice) else 0 end) D6,
		max(case a.retention_day when 7 then (a.retention_num / b.role_choice) else 0 end) D7,
		max(case a.retention_day when 8 then (a.retention_num / b.role_choice) else 0 end) D8,
		max(case a.retention_day when 9 then (a.retention_num / b.role_choice) else 0 end) D9,
		max(case a.retention_day when 10 then (a.retention_num / b.role_choice) else 0 end) D10,
		max(case a.retention_day when 11 then (a.retention_num / b.role_choice) else 0 end) D11,
		max(case a.retention_day when 12 then (a.retention_num / b.role_choice) else 0 end) D12,
		max(case a.retention_day when 13 then (a.retention_num / b.role_choice) else 0 end) D13,
		max(case a.retention_day when 14 then (a.retention_num / b.role_choice) else 0 end) D14,
		max(case a.retention_day when 15 then (a.retention_num / b.role_choice) else 0 end) D15,
		max(case a.retention_day when 16 then (a.retention_num / b.role_choice) else 0 end) D16,
		max(case a.retention_day when 17 then (a.retention_num / b.role_choice) else 0 end) D17,
		max(case a.retention_day when 18 then (a.retention_num / b.role_choice) else 0 end) D18,
		max(case a.retention_day when 19 then (a.retention_num / b.role_choice) else 0 end) D19,
		max(case a.retention_day when 20 then (a.retention_num / b.role_choice) else 0 end) D20,
		max(case a.retention_day when 21 then (a.retention_num / b.role_choice) else 0 end) D21,
		max(case a.retention_day when 22 then (a.retention_num / b.role_choice) else 0 end) D22,
		max(case a.retention_day when 23 then (a.retention_num / b.role_choice) else 0 end) D23,
		max(case a.retention_day when 24 then (a.retention_num / b.role_choice) else 0 end) D24,
		max(case a.retention_day when 25 then (a.retention_num / b.role_choice) else 0 end) D25,
		max(case a.retention_day when 26 then (a.retention_num / b.role_choice) else 0 end) D26,
		max(case a.retention_day when 27 then (a.retention_num / b.role_choice) else 0 end) D27,
		max(case a.retention_day when 28 then (a.retention_num / b.role_choice) else 0 end) D28,
		max(case a.retention_day when 29 then (a.retention_num / b.role_choice) else 0 end) D29,
		max(case a.retention_day when 30 then (a.retention_num / b.role_choice) else 0 end) D30,
		max(case a.retention_day when 31 then (a.retention_num / b.role_choice) else 0 end) D31,
		max(case a.retention_day when 32 then (a.retention_num / b.role_choice) else 0 end) D32,
		max(case a.retention_day when 33 then (a.retention_num / b.role_choice) else 0 end) D33,
		max(case a.retention_day when 34 then (a.retention_num / b.role_choice) else 0 end) D34,
		max(case a.retention_day when 35 then (a.retention_num / b.role_choice) else 0 end) D35,
		max(case a.retention_day when 36 then (a.retention_num / b.role_choice) else 0 end) D36,
		max(case a.retention_day when 37 then (a.retention_num / b.role_choice) else 0 end) D37,
		max(case a.retention_day when 38 then (a.retention_num / b.role_choice) else 0 end) D38,
		max(case a.retention_day when 39 then (a.retention_num / b.role_choice) else 0 end) D39,
		max(case a.retention_day when 40 then (a.retention_num / b.role_choice) else 0 end) D40,
		max(case a.retention_day when 41 then (a.retention_num / b.role_choice) else 0 end) D41,
		max(case a.retention_day when 42 then (a.retention_num / b.role_choice) else 0 end) D42,
		max(case a.retention_day when 43 then (a.retention_num / b.role_choice) else 0 end) D43,
		max(case a.retention_day when 44 then (a.retention_num / b.role_choice) else 0 end) D44,
		max(case a.retention_day when 45 then (a.retention_num / b.role_choice) else 0 end) D45,
		max(case a.retention_day when 46 then (a.retention_num / b.role_choice) else 0 end) D46,
		max(case a.retention_day when 47 then (a.retention_num / b.role_choice) else 0 end) D47,
		max(case a.retention_day when 48 then (a.retention_num / b.role_choice) else 0 end) D48,
		max(case a.retention_day when 49 then (a.retention_num / b.role_choice) else 0 end) D49,
		max(case a.retention_day when 50 then (a.retention_num / b.role_choice) else 0 end) D50,
		max(case a.retention_day when 51 then (a.retention_num / b.role_choice) else 0 end) D51,
		max(case a.retention_day when 52 then (a.retention_num / b.role_choice) else 0 end) D52,
		max(case a.retention_day when 53 then (a.retention_num / b.role_choice) else 0 end) D53,
		max(case a.retention_day when 54 then (a.retention_num / b.role_choice) else 0 end) D54,
		max(case a.retention_day when 55 then (a.retention_num / b.role_choice) else 0 end) D55,
		max(case a.retention_day when 56 then (a.retention_num / b.role_choice) else 0 end) D56,
		max(case a.retention_day when 57 then (a.retention_num / b.role_choice) else 0 end) D57,
		max(case a.retention_day when 58 then (a.retention_num / b.role_choice) else 0 end) D58,
		max(case a.retention_day when 59 then (a.retention_num / b.role_choice) else 0 end) D59,
		max(case a.retention_day when 60 then (a.retention_num / b.role_choice) else 0 end) D60,
		max(case a.retention_day when 61 then (a.retention_num / b.role_choice) else 0 end) D61,
		max(case a.retention_day when 62 then (a.retention_num / b.role_choice) else 0 end) D62,
		max(case a.retention_day when 63 then (a.retention_num / b.role_choice) else 0 end) D63,
		max(case a.retention_day when 64 then (a.retention_num / b.role_choice) else 0 end) D64,
		max(case a.retention_day when 65 then (a.retention_num / b.role_choice) else 0 end) D65,
		max(case a.retention_day when 66 then (a.retention_num / b.role_choice) else 0 end) D66,
		max(case a.retention_day when 67 then (a.retention_num / b.role_choice) else 0 end) D67,
		max(case a.retention_day when 68 then (a.retention_num / b.role_choice) else 0 end) D68,
		max(case a.retention_day when 69 then (a.retention_num / b.role_choice) else 0 end) D69,
		max(case a.retention_day when 70 then (a.retention_num / b.role_choice) else 0 end) D70,
		max(case a.retention_day when 71 then (a.retention_num / b.role_choice) else 0 end) D71,
		max(case a.retention_day when 72 then (a.retention_num / b.role_choice) else 0 end) D72,
		max(case a.retention_day when 73 then (a.retention_num / b.role_choice) else 0 end) D73,
		max(case a.retention_day when 74 then (a.retention_num / b.role_choice) else 0 end) D74,
		max(case a.retention_day when 75 then (a.retention_num / b.role_choice) else 0 end) D75,
		max(case a.retention_day when 76 then (a.retention_num / b.role_choice) else 0 end) D76,
		max(case a.retention_day when 77 then (a.retention_num / b.role_choice) else 0 end) D77,
		max(case a.retention_day when 78 then (a.retention_num / b.role_choice) else 0 end) D78,
		max(case a.retention_day when 79 then (a.retention_num / b.role_choice) else 0 end) D79,
		max(case a.retention_day when 80 then (a.retention_num / b.role_choice) else 0 end) D80,
		max(case a.retention_day when 81 then (a.retention_num / b.role_choice) else 0 end) D81,
		max(case a.retention_day when 82 then (a.retention_num / b.role_choice) else 0 end) D82,
		max(case a.retention_day when 83 then (a.retention_num / b.role_choice) else 0 end) D83,
		max(case a.retention_day when 84 then (a.retention_num / b.role_choice) else 0 end) D84,
		max(case a.retention_day when 85 then (a.retention_num / b.role_choice) else 0 end) D85,
		max(case a.retention_day when 86 then (a.retention_num / b.role_choice) else 0 end) D86,
		max(case a.retention_day when 87 then (a.retention_num / b.role_choice) else 0 end) D87,
		max(case a.retention_day when 88 then (a.retention_num / b.role_choice) else 0 end) D88,
		max(case a.retention_day when 89 then (a.retention_num / b.role_choice) else 0 end) D89,
		max(case a.retention_day when 90 then (a.retention_num / b.role_choice) else 0 end) D90
	from 
	(
	 select * from 
	 user_retention_source_ltv 
	<if test="_parameter != null">
		<include refid="Vo_Where_Clause" />
		<![CDATA[ 
				and (retention_day >= 0 and retention_day <= 90) 
			]]>
	</if>
) a
left outer join
(
	select day,role_choice
	from source_daily_report 
    <if test="_parameter != null">
		<include refid="Vo_Where_Clause_daily_report" />
	</if>
) b on a.install_day = b.day 
group by install_day
</select>
	
	<select id="selectHorizontal4InstallPayList" parameterType="com.hoolai.bi.report.vo.UserRetentionLtvVO" resultMap="LifeResultMap">
	select install_day,max(install) install,
		max(case retention_day when 0 then total_amount else 0 end) D0,
		max(case retention_day when 1 then total_amount else 0 end) D1,
		max(case retention_day when 2 then total_amount else 0 end) D2,
		max(case retention_day when 3 then total_amount else 0 end) D3,
		max(case retention_day when 4 then total_amount else 0 end) D4,
		max(case retention_day when 5 then total_amount else 0 end) D5,
		max(case retention_day when 6 then total_amount else 0 end) D6,
		max(case retention_day when 7 then total_amount else 0 end) D7,
		max(case retention_day when 8 then total_amount else 0 end) D8,
		max(case retention_day when 9 then total_amount else 0 end) D9,
		max(case retention_day when 10 then total_amount else 0 end) D10,
		max(case retention_day when 11 then total_amount else 0 end) D11,
		max(case retention_day when 12 then total_amount else 0 end) D12,
		max(case retention_day when 13 then total_amount else 0 end) D13,
		max(case retention_day when 14 then total_amount else 0 end) D14,
		max(case retention_day when 15 then total_amount else 0 end) D15,
		max(case retention_day when 16 then total_amount else 0 end) D16,
		max(case retention_day when 17 then total_amount else 0 end) D17,
		max(case retention_day when 18 then total_amount else 0 end) D18,
		max(case retention_day when 19 then total_amount else 0 end) D19,
		max(case retention_day when 20 then total_amount else 0 end) D20,
		max(case retention_day when 21 then total_amount else 0 end) D21,
		max(case retention_day when 22 then total_amount else 0 end) D22,
		max(case retention_day when 23 then total_amount else 0 end) D23,
		max(case retention_day when 24 then total_amount else 0 end) D24,
		max(case retention_day when 25 then total_amount else 0 end) D25,
		max(case retention_day when 26 then total_amount else 0 end) D26,
		max(case retention_day when 27 then total_amount else 0 end) D27,
		max(case retention_day when 28 then total_amount else 0 end) D28,
		max(case retention_day when 29 then total_amount else 0 end) D29,
		max(case retention_day when 30 then total_amount else 0 end) D30,
		max(case retention_day when 31 then total_amount else 0 end) D31,
		max(case retention_day when 32 then total_amount else 0 end) D32,
		max(case retention_day when 33 then total_amount else 0 end) D33,
		max(case retention_day when 34 then total_amount else 0 end) D34,
		max(case retention_day when 35 then total_amount else 0 end) D35,
		max(case retention_day when 36 then total_amount else 0 end) D36,
		max(case retention_day when 37 then total_amount else 0 end) D37,
		max(case retention_day when 38 then total_amount else 0 end) D38,
		max(case retention_day when 39 then total_amount else 0 end) D39,
		max(case retention_day when 40 then total_amount else 0 end) D40,
		max(case retention_day when 41 then total_amount else 0 end) D41,
		max(case retention_day when 42 then total_amount else 0 end) D42,
		max(case retention_day when 43 then total_amount else 0 end) D43,
		max(case retention_day when 44 then total_amount else 0 end) D44,
		max(case retention_day when 45 then total_amount else 0 end) D45,
		max(case retention_day when 46 then total_amount else 0 end) D46,
		max(case retention_day when 47 then total_amount else 0 end) D47,
		max(case retention_day when 48 then total_amount else 0 end) D48,
		max(case retention_day when 49 then total_amount else 0 end) D49,
		max(case retention_day when 50 then total_amount else 0 end) D50,
		max(case retention_day when 51 then total_amount else 0 end) D51,
		max(case retention_day when 52 then total_amount else 0 end) D52,
		max(case retention_day when 53 then total_amount else 0 end) D53,
		max(case retention_day when 54 then total_amount else 0 end) D54,
		max(case retention_day when 55 then total_amount else 0 end) D55,
		max(case retention_day when 56 then total_amount else 0 end) D56,
		max(case retention_day when 57 then total_amount else 0 end) D57,
		max(case retention_day when 58 then total_amount else 0 end) D58,
		max(case retention_day when 59 then total_amount else 0 end) D59,
		max(case retention_day when 60 then total_amount else 0 end) D60,
		max(case retention_day when 61 then total_amount else 0 end) D61,
		max(case retention_day when 62 then total_amount else 0 end) D62,
		max(case retention_day when 63 then total_amount else 0 end) D63,
		max(case retention_day when 64 then total_amount else 0 end) D64,
		max(case retention_day when 65 then total_amount else 0 end) D65,
		max(case retention_day when 66 then total_amount else 0 end) D66,
		max(case retention_day when 67 then total_amount else 0 end) D67,
		max(case retention_day when 68 then total_amount else 0 end) D68,
		max(case retention_day when 69 then total_amount else 0 end) D69,
		max(case retention_day when 70 then total_amount else 0 end) D70,
		max(case retention_day when 71 then total_amount else 0 end) D71,
		max(case retention_day when 72 then total_amount else 0 end) D72,
		max(case retention_day when 73 then total_amount else 0 end) D73,
		max(case retention_day when 74 then total_amount else 0 end) D74,
		max(case retention_day when 75 then total_amount else 0 end) D75,
		max(case retention_day when 76 then total_amount else 0 end) D76,
		max(case retention_day when 77 then total_amount else 0 end) D77,
		max(case retention_day when 78 then total_amount else 0 end) D78,
		max(case retention_day when 79 then total_amount else 0 end) D79,
		max(case retention_day when 80 then total_amount else 0 end) D80,
		max(case retention_day when 81 then total_amount else 0 end) D81,
		max(case retention_day when 82 then total_amount else 0 end) D82,
		max(case retention_day when 83 then total_amount else 0 end) D83,
		max(case retention_day when 84 then total_amount else 0 end) D84,
		max(case retention_day when 85 then total_amount else 0 end) D85,
		max(case retention_day when 86 then total_amount else 0 end) D86,
		max(case retention_day when 87 then total_amount else 0 end) D87,
		max(case retention_day when 88 then total_amount else 0 end) D88,
		max(case retention_day when 89 then total_amount else 0 end) D89,
		max(case retention_day when 90 then total_amount else 0 end) D90
	from user_retention_source_ltv 
	<if test="_parameter != null">
		<include refid="Vo_Where_Clause" />
		<![CDATA[ 
				and (retention_day >= 0 and retention_day <= 90) 
				group by install_day
			]]>
	</if>
</select>

	<select id="selectHorizontal4TotalInstallPayList" parameterType="com.hoolai.bi.report.vo.UserRetentionLtvVO" resultMap="LifeResultMap">
	
 select total_install as install,
sum(case when t1.retention_day=0 then case when total_amount is null then 0 else total_amount end end) as d0,
sum(case when t1.retention_day=1 then case when total_amount is null then 0 else total_amount end end) as d1,
sum(case when t1.retention_day=2 then case when total_amount is null then 0 else total_amount end end) as d2,
sum(case when t1.retention_day=3 then case when total_amount is null then 0 else total_amount end end) as d3,
sum(case when t1.retention_day=4 then case when total_amount is null then 0 else total_amount end end) as d4,
sum(case when t1.retention_day=5 then case when total_amount is null then 0 else total_amount end end) as d5,
sum(case when t1.retention_day=6 then case when total_amount is null then 0 else total_amount end end) as d6,
sum(case when t1.retention_day=7 then case when total_amount is null then 0 else total_amount end end) as d7,
sum(case when t1.retention_day=8 then case when total_amount is null then 0 else total_amount end end) as d8,
sum(case when t1.retention_day=9 then case when total_amount is null then 0 else total_amount end end) as d9,
sum(case when t1.retention_day=10 then case when total_amount is null then 0 else total_amount end end) as d10,
sum(case when t1.retention_day=11 then case when total_amount is null then 0 else total_amount end end) as d11,
sum(case when t1.retention_day=12 then case when total_amount is null then 0 else total_amount end end) as d12,
sum(case when t1.retention_day=13 then case when total_amount is null then 0 else total_amount end end) as d13,
sum(case when t1.retention_day=14 then case when total_amount is null then 0 else total_amount end end) as d14,
sum(case when t1.retention_day=15 then case when total_amount is null then 0 else total_amount end end) as d15,
sum(case when t1.retention_day=16 then case when total_amount is null then 0 else total_amount end end) as d16,
sum(case when t1.retention_day=17 then case when total_amount is null then 0 else total_amount end end) as d17,
sum(case when t1.retention_day=18 then case when total_amount is null then 0 else total_amount end end) as d18,
sum(case when t1.retention_day=19 then case when total_amount is null then 0 else total_amount end end) as d19,
sum(case when t1.retention_day=20 then case when total_amount is null then 0 else total_amount end end) as d20,
sum(case when t1.retention_day=21 then case when total_amount is null then 0 else total_amount end end) as d21,
sum(case when t1.retention_day=22 then case when total_amount is null then 0 else total_amount end end) as d22,
sum(case when t1.retention_day=23 then case when total_amount is null then 0 else total_amount end end) as d23,
sum(case when t1.retention_day=24 then case when total_amount is null then 0 else total_amount end end) as d24,
sum(case when t1.retention_day=25 then case when total_amount is null then 0 else total_amount end end) as d25,
sum(case when t1.retention_day=26 then case when total_amount is null then 0 else total_amount end end) as d26,
sum(case when t1.retention_day=27 then case when total_amount is null then 0 else total_amount end end) as d27,
sum(case when t1.retention_day=28 then case when total_amount is null then 0 else total_amount end end) as d28,
sum(case when t1.retention_day=29 then case when total_amount is null then 0 else total_amount end end) as d29,
sum(case when t1.retention_day=30 then case when total_amount is null then 0 else total_amount end end) as d30,
sum(case when t1.retention_day=31 then case when total_amount is null then 0 else total_amount end end) as d31,
sum(case when t1.retention_day=32 then case when total_amount is null then 0 else total_amount end end) as d32,
sum(case when t1.retention_day=33 then case when total_amount is null then 0 else total_amount end end) as d33,
sum(case when t1.retention_day=34 then case when total_amount is null then 0 else total_amount end end) as d34,
sum(case when t1.retention_day=35 then case when total_amount is null then 0 else total_amount end end) as d35,
sum(case when t1.retention_day=36 then case when total_amount is null then 0 else total_amount end end) as d36,
sum(case when t1.retention_day=37 then case when total_amount is null then 0 else total_amount end end) as d37,
sum(case when t1.retention_day=38 then case when total_amount is null then 0 else total_amount end end) as d38,
sum(case when t1.retention_day=39 then case when total_amount is null then 0 else total_amount end end) as d39,
sum(case when t1.retention_day=40 then case when total_amount is null then 0 else total_amount end end) as d40,
sum(case when t1.retention_day=41 then case when total_amount is null then 0 else total_amount end end) as d41,
sum(case when t1.retention_day=42 then case when total_amount is null then 0 else total_amount end end) as d42,
sum(case when t1.retention_day=43 then case when total_amount is null then 0 else total_amount end end) as d43,
sum(case when t1.retention_day=44 then case when total_amount is null then 0 else total_amount end end) as d44,
sum(case when t1.retention_day=45 then case when total_amount is null then 0 else total_amount end end) as d45,
sum(case when t1.retention_day=46 then case when total_amount is null then 0 else total_amount end end) as d46,
sum(case when t1.retention_day=47 then case when total_amount is null then 0 else total_amount end end) as d47,
sum(case when t1.retention_day=48 then case when total_amount is null then 0 else total_amount end end) as d48,
sum(case when t1.retention_day=49 then case when total_amount is null then 0 else total_amount end end) as d49,
sum(case when t1.retention_day=50 then case when total_amount is null then 0 else total_amount end end) as d50,
sum(case when t1.retention_day=51 then case when total_amount is null then 0 else total_amount end end) as d51,
sum(case when t1.retention_day=52 then case when total_amount is null then 0 else total_amount end end) as d52,
sum(case when t1.retention_day=53 then case when total_amount is null then 0 else total_amount end end) as d53,
sum(case when t1.retention_day=54 then case when total_amount is null then 0 else total_amount end end) as d54,
sum(case when t1.retention_day=55 then case when total_amount is null then 0 else total_amount end end) as d55,
sum(case when t1.retention_day=56 then case when total_amount is null then 0 else total_amount end end) as d56,
sum(case when t1.retention_day=57 then case when total_amount is null then 0 else total_amount end end) as d57,
sum(case when t1.retention_day=58 then case when total_amount is null then 0 else total_amount end end) as d58,
sum(case when t1.retention_day=59 then case when total_amount is null then 0 else total_amount end end) as d59,
sum(case when t1.retention_day=60 then case when total_amount is null then 0 else total_amount end end) as d60,
sum(case when t1.retention_day=61 then case when total_amount is null then 0 else total_amount end end) as d61,
sum(case when t1.retention_day=62 then case when total_amount is null then 0 else total_amount end end) as d62,
sum(case when t1.retention_day=63 then case when total_amount is null then 0 else total_amount end end) as d63,
sum(case when t1.retention_day=64 then case when total_amount is null then 0 else total_amount end end) as d64,
sum(case when t1.retention_day=65 then case when total_amount is null then 0 else total_amount end end) as d65,
sum(case when t1.retention_day=66 then case when total_amount is null then 0 else total_amount end end) as d66,
sum(case when t1.retention_day=67 then case when total_amount is null then 0 else total_amount end end) as d67,
sum(case when t1.retention_day=68 then case when total_amount is null then 0 else total_amount end end) as d68,
sum(case when t1.retention_day=69 then case when total_amount is null then 0 else total_amount end end) as d69,
sum(case when t1.retention_day=70 then case when total_amount is null then 0 else total_amount end end) as d70,
sum(case when t1.retention_day=71 then case when total_amount is null then 0 else total_amount end end) as d71,
sum(case when t1.retention_day=72 then case when total_amount is null then 0 else total_amount end end) as d72,
sum(case when t1.retention_day=73 then case when total_amount is null then 0 else total_amount end end) as d73,
sum(case when t1.retention_day=74 then case when total_amount is null then 0 else total_amount end end) as d74,
sum(case when t1.retention_day=75 then case when total_amount is null then 0 else total_amount end end) as d75,
sum(case when t1.retention_day=76 then case when total_amount is null then 0 else total_amount end end) as d76,
sum(case when t1.retention_day=77 then case when total_amount is null then 0 else total_amount end end) as d77,
sum(case when t1.retention_day=78 then case when total_amount is null then 0 else total_amount end end) as d78,
sum(case when t1.retention_day=79 then case when total_amount is null then 0 else total_amount end end) as d79,
sum(case when t1.retention_day=80 then case when total_amount is null then 0 else total_amount end end) as d80,
sum(case when t1.retention_day=81 then case when total_amount is null then 0 else total_amount end end) as d81,
sum(case when t1.retention_day=82 then case when total_amount is null then 0 else total_amount end end) as d82,
sum(case when t1.retention_day=83 then case when total_amount is null then 0 else total_amount end end) as d83,
sum(case when t1.retention_day=84 then case when total_amount is null then 0 else total_amount end end) as d84,
sum(case when t1.retention_day=85 then case when total_amount is null then 0 else total_amount end end) as d85,
sum(case when t1.retention_day=86 then case when total_amount is null then 0 else total_amount end end) as d86,
sum(case when t1.retention_day=87 then case when total_amount is null then 0 else total_amount end end) as d87,
sum(case when t1.retention_day=88 then case when total_amount is null then 0 else total_amount end end) as d88,
sum(case when t1.retention_day=89 then case when total_amount is null then 0 else total_amount end end) as d89,
sum(case when t1.retention_day=90 then case when total_amount is null then 0 else total_amount end end) as d90


	
	from
	(select b.snid,b.gameid, b.retention_day,b.source,sum(b.total_amount) as total_amount
		from
		  (select * from user_retention_source_ltv
		      <if test="_parameter != null">
					<include refid="Vo_Where_Clause" />
					<![CDATA[ 
							and (retention_day >= 0 and retention_day <= 90) 
						]]>
			</if>
	      
	     
			
		  )b
		group by b.snid,b.gameid, b.retention_day,b.source
	    order by b.snid,b.gameid,b.retention_day,b.source)t1
	left outer join 
	(select snid,gameid,source,sum(case when retention_day=0 then install end )  as total_install
	from user_retention_source_ltv
			 <if test="_parameter != null">
					<include refid="Vo_Where_Clause" />
					
			</if>
	 group by snid,gameid,source)t2
	on t1.snid=t2.snid and t1.gameid=t2.gameid and t1.source=t2.source
group by total_install

	
</select>

<!---      -->
<select id="selectHorizontal4TotalInstallPayList2" parameterType="com.hoolai.bi.report.vo.UserRetentionLtvVO" resultMap="LifeResultMap">
	select t1.snid,t1.gameid,
sum(case when t1.retention_day=0 then total_install end) as install,
sum(case when t1.retention_day=0 then case when total_amount is null then 0 else total_amount/total_install end  end) as d0,
sum(case when t1.retention_day=1 then case when total_amount is null then 0 else total_amount /total_install end end) as d1,
sum(case when t1.retention_day=2 then case when total_amount is null then 0 else total_amount /total_install end end) as d2,
sum(case when t1.retention_day=3 then case when total_amount is null then 0 else total_amount /total_install end end) as d3,
sum(case when t1.retention_day=4 then case when total_amount is null then 0 else total_amount /total_install end end) as d4,
sum(case when t1.retention_day=5 then case when total_amount is null then 0 else total_amount /total_install end end) as d5,
sum(case when t1.retention_day=6 then case when total_amount is null then 0 else total_amount /total_install end end) as d6,
sum(case when t1.retention_day=7 then case when total_amount is null then 0 else total_amount /total_install end end) as d7,
sum(case when t1.retention_day=8 then case when total_amount is null then 0 else total_amount /total_install end end) as d8,
sum(case when t1.retention_day=9 then case when total_amount is null then 0 else total_amount /total_install end end) as d9,
sum(case when t1.retention_day=10 then case when total_amount is null then 0 else total_amount/total_install end end) as d10,
sum(case when t1.retention_day=11 then case when total_amount is null then 0 else total_amount/total_install end end) as d11,
sum(case when t1.retention_day=12 then case when total_amount is null then 0 else total_amount/total_install end end) as d12,
sum(case when t1.retention_day=13 then case when total_amount is null then 0 else total_amount/total_install end end) as d13,
sum(case when t1.retention_day=14 then case when total_amount is null then 0 else total_amount/total_install end end) as d14,
sum(case when t1.retention_day=15 then case when total_amount is null then 0 else total_amount/total_install end end) as d15,
sum(case when t1.retention_day=16 then case when total_amount is null then 0 else total_amount/total_install end end) as d16,
sum(case when t1.retention_day=17 then case when total_amount is null then 0 else total_amount/total_install end end) as d17,
sum(case when t1.retention_day=18 then case when total_amount is null then 0 else total_amount/total_install end end) as d18,
sum(case when t1.retention_day=19 then case when total_amount is null then 0 else total_amount/total_install end end) as d19,
sum(case when t1.retention_day=20 then case when total_amount is null then 0 else total_amount/total_install end end) as d20,
sum(case when t1.retention_day=21 then case when total_amount is null then 0 else total_amount/total_install end end) as d21,
sum(case when t1.retention_day=22 then case when total_amount is null then 0 else total_amount/total_install end end) as d22,
sum(case when t1.retention_day=23 then case when total_amount is null then 0 else total_amount/total_install end end) as d23,
sum(case when t1.retention_day=24 then case when total_amount is null then 0 else total_amount/total_install end end) as d24,
sum(case when t1.retention_day=25 then case when total_amount is null then 0 else total_amount/total_install end end) as d25,
sum(case when t1.retention_day=26 then case when total_amount is null then 0 else total_amount/total_install end end) as d26,
sum(case when t1.retention_day=27 then case when total_amount is null then 0 else total_amount/total_install end end) as d27,
sum(case when t1.retention_day=28 then case when total_amount is null then 0 else total_amount/total_install end end) as d28,
sum(case when t1.retention_day=29 then case when total_amount is null then 0 else total_amount/total_install end end) as d29,
sum(case when t1.retention_day=30 then case when total_amount is null then 0 else total_amount/total_install end end) as d30,
sum(case when t1.retention_day=31 then case when total_amount is null then 0 else total_amount/total_install end end) as d31,
sum(case when t1.retention_day=32 then case when total_amount is null then 0 else total_amount/total_install end end) as d32,
sum(case when t1.retention_day=33 then case when total_amount is null then 0 else total_amount/total_install end end) as d33,
sum(case when t1.retention_day=34 then case when total_amount is null then 0 else total_amount/total_install end end) as d34,
sum(case when t1.retention_day=35 then case when total_amount is null then 0 else total_amount/total_install end end) as d35,
sum(case when t1.retention_day=36 then case when total_amount is null then 0 else total_amount/total_install end end) as d36,
sum(case when t1.retention_day=37 then case when total_amount is null then 0 else total_amount/total_install end end) as d37,
sum(case when t1.retention_day=38 then case when total_amount is null then 0 else total_amount/total_install end end) as d38,
sum(case when t1.retention_day=39 then case when total_amount is null then 0 else total_amount/total_install end end) as d39,
sum(case when t1.retention_day=40 then case when total_amount is null then 0 else total_amount/total_install end end) as d40,
sum(case when t1.retention_day=41 then case when total_amount is null then 0 else total_amount/total_install end end) as d41,
sum(case when t1.retention_day=42 then case when total_amount is null then 0 else total_amount/total_install end end) as d42,
sum(case when t1.retention_day=43 then case when total_amount is null then 0 else total_amount/total_install end end) as d43,
sum(case when t1.retention_day=44 then case when total_amount is null then 0 else total_amount/total_install end end) as d44,
sum(case when t1.retention_day=45 then case when total_amount is null then 0 else total_amount/total_install end end) as d45,
sum(case when t1.retention_day=46 then case when total_amount is null then 0 else total_amount/total_install end end) as d46,
sum(case when t1.retention_day=47 then case when total_amount is null then 0 else total_amount/total_install end end) as d47,
sum(case when t1.retention_day=48 then case when total_amount is null then 0 else total_amount/total_install end end) as d48,
sum(case when t1.retention_day=49 then case when total_amount is null then 0 else total_amount/total_install end end) as d49,
sum(case when t1.retention_day=50 then case when total_amount is null then 0 else total_amount/total_install end end) as d50,
sum(case when t1.retention_day=51 then case when total_amount is null then 0 else total_amount/total_install end end) as d51,
sum(case when t1.retention_day=52 then case when total_amount is null then 0 else total_amount/total_install end end) as d52,
sum(case when t1.retention_day=53 then case when total_amount is null then 0 else total_amount/total_install end end) as d53,
sum(case when t1.retention_day=54 then case when total_amount is null then 0 else total_amount/total_install end end) as d54,
sum(case when t1.retention_day=55 then case when total_amount is null then 0 else total_amount/total_install end end) as d55,
sum(case when t1.retention_day=56 then case when total_amount is null then 0 else total_amount/total_install end end) as d56,
sum(case when t1.retention_day=57 then case when total_amount is null then 0 else total_amount/total_install end end) as d57,
sum(case when t1.retention_day=58 then case when total_amount is null then 0 else total_amount/total_install end end) as d58,
sum(case when t1.retention_day=59 then case when total_amount is null then 0 else total_amount/total_install end end) as d59,
sum(case when t1.retention_day=60 then case when total_amount is null then 0 else total_amount/total_install end end) as d60,
sum(case when t1.retention_day=61 then case when total_amount is null then 0 else total_amount/total_install end end) as d61,
sum(case when t1.retention_day=62 then case when total_amount is null then 0 else total_amount/total_install end end) as d62,
sum(case when t1.retention_day=63 then case when total_amount is null then 0 else total_amount/total_install end end) as d63,
sum(case when t1.retention_day=64 then case when total_amount is null then 0 else total_amount/total_install end end) as d64,
sum(case when t1.retention_day=65 then case when total_amount is null then 0 else total_amount/total_install end end) as d65,
sum(case when t1.retention_day=66 then case when total_amount is null then 0 else total_amount/total_install end end) as d66,
sum(case when t1.retention_day=67 then case when total_amount is null then 0 else total_amount/total_install end end) as d67,
sum(case when t1.retention_day=68 then case when total_amount is null then 0 else total_amount/total_install end end) as d68,
sum(case when t1.retention_day=69 then case when total_amount is null then 0 else total_amount/total_install end end) as d69,
sum(case when t1.retention_day=70 then case when total_amount is null then 0 else total_amount/total_install end end) as d70,
sum(case when t1.retention_day=71 then case when total_amount is null then 0 else total_amount/total_install end end) as d71,
sum(case when t1.retention_day=72 then case when total_amount is null then 0 else total_amount/total_install end end) as d72,
sum(case when t1.retention_day=73 then case when total_amount is null then 0 else total_amount/total_install end end) as d73,
sum(case when t1.retention_day=74 then case when total_amount is null then 0 else total_amount/total_install end end) as d74,
sum(case when t1.retention_day=75 then case when total_amount is null then 0 else total_amount/total_install end end) as d75,
sum(case when t1.retention_day=76 then case when total_amount is null then 0 else total_amount/total_install end end) as d76,
sum(case when t1.retention_day=77 then case when total_amount is null then 0 else total_amount/total_install end end) as d77,
sum(case when t1.retention_day=78 then case when total_amount is null then 0 else total_amount/total_install end end) as d78,
sum(case when t1.retention_day=79 then case when total_amount is null then 0 else total_amount/total_install end end) as d79,
sum(case when t1.retention_day=80 then case when total_amount is null then 0 else total_amount/total_install end end) as d80,
sum(case when t1.retention_day=81 then case when total_amount is null then 0 else total_amount/total_install end end) as d81,
sum(case when t1.retention_day=82 then case when total_amount is null then 0 else total_amount/total_install end end) as d82,
sum(case when t1.retention_day=83 then case when total_amount is null then 0 else total_amount/total_install end end) as d83,
sum(case when t1.retention_day=84 then case when total_amount is null then 0 else total_amount/total_install end end) as d84,
sum(case when t1.retention_day=85 then case when total_amount is null then 0 else total_amount/total_install end end) as d85,
sum(case when t1.retention_day=86 then case when total_amount is null then 0 else total_amount/total_install end end) as d86,
sum(case when t1.retention_day=87 then case when total_amount is null then 0 else total_amount/total_install end end) as d87,
sum(case when t1.retention_day=88 then case when total_amount is null then 0 else total_amount/total_install end end) as d88,
sum(case when t1.retention_day=89 then case when total_amount is null then 0 else total_amount/total_install end end) as d89,
sum(case when t1.retention_day=90 then case when total_amount is null then 0 else total_amount/total_install end end) as d90


	
	from
(	select b.snid,b.gameid, b.retention_day,sum(b.total_amount) as total_amount
		from
		  (select * from user_retention_source_ltv
		  
	 
	     <if test="_parameter != null">
					<include refid="Vo_Where_Clause" />
					<![CDATA[ 
							and (retention_day >= 0 and retention_day <= 90) 
						]]>
			</if>
			
			
		  )b
		group by b.snid,b.gameid, b.retention_day
	    order by b.snid,b.gameid,b.retention_day)t1
	left outer join 
	(select snid,gameid,retention_day,sum(install) as total_install
		from user_retention_source_ltv
		
		<if test="_parameter != null">
					<include refid="Vo_Where_Clause" />
					
			</if>
   
group by snid,gameid,retention_day
)t2
on t1.snid=t2.snid and t1.gameid=t2.gameid and  t1.retention_day=t2.retention_day
group by t1.snid,t1.gameid


</select>

<!--  -- -->
<select id="selectHorizontal4TotalInstallPayList_export" parameterType="com.hoolai.bi.report.vo.UserRetentionLtvVO" resultMap="LifeResultMap">
select t1.snid,t1.gameid,
sum(case when t1.retention_day=0 then total_install end) as install,
sum(case when t1.retention_day=0 then case when total_amount is null then 0 else total_amount/total_install end  end) as d0,
sum(case when t1.retention_day=1 then case when total_amount is null then 0 else total_amount /total_install end end) as d1,
sum(case when t1.retention_day=2 then case when total_amount is null then 0 else total_amount /total_install end end) as d2,
sum(case when t1.retention_day=3 then case when total_amount is null then 0 else total_amount /total_install end end) as d3,
sum(case when t1.retention_day=4 then case when total_amount is null then 0 else total_amount /total_install end end) as d4,
sum(case when t1.retention_day=5 then case when total_amount is null then 0 else total_amount /total_install end end) as d5,
sum(case when t1.retention_day=6 then case when total_amount is null then 0 else total_amount /total_install end end) as d6,
sum(case when t1.retention_day=7 then case when total_amount is null then 0 else total_amount /total_install end end) as d7,
sum(case when t1.retention_day=8 then case when total_amount is null then 0 else total_amount /total_install end end) as d8,
sum(case when t1.retention_day=9 then case when total_amount is null then 0 else total_amount /total_install end end) as d9,
sum(case when t1.retention_day=10 then case when total_amount is null then 0 else total_amount/total_install end end) as d10,
sum(case when t1.retention_day=11 then case when total_amount is null then 0 else total_amount/total_install end end) as d11,
sum(case when t1.retention_day=12 then case when total_amount is null then 0 else total_amount/total_install end end) as d12,
sum(case when t1.retention_day=13 then case when total_amount is null then 0 else total_amount/total_install end end) as d13,
sum(case when t1.retention_day=14 then case when total_amount is null then 0 else total_amount/total_install end end) as d14,
sum(case when t1.retention_day=15 then case when total_amount is null then 0 else total_amount/total_install end end) as d15,
sum(case when t1.retention_day=16 then case when total_amount is null then 0 else total_amount/total_install end end) as d16,
sum(case when t1.retention_day=17 then case when total_amount is null then 0 else total_amount/total_install end end) as d17,
sum(case when t1.retention_day=18 then case when total_amount is null then 0 else total_amount/total_install end end) as d18,
sum(case when t1.retention_day=19 then case when total_amount is null then 0 else total_amount/total_install end end) as d19,
sum(case when t1.retention_day=20 then case when total_amount is null then 0 else total_amount/total_install end end) as d20,
sum(case when t1.retention_day=21 then case when total_amount is null then 0 else total_amount/total_install end end) as d21,
sum(case when t1.retention_day=22 then case when total_amount is null then 0 else total_amount/total_install end end) as d22,
sum(case when t1.retention_day=23 then case when total_amount is null then 0 else total_amount/total_install end end) as d23,
sum(case when t1.retention_day=24 then case when total_amount is null then 0 else total_amount/total_install end end) as d24,
sum(case when t1.retention_day=25 then case when total_amount is null then 0 else total_amount/total_install end end) as d25,
sum(case when t1.retention_day=26 then case when total_amount is null then 0 else total_amount/total_install end end) as d26,
sum(case when t1.retention_day=27 then case when total_amount is null then 0 else total_amount/total_install end end) as d27,
sum(case when t1.retention_day=28 then case when total_amount is null then 0 else total_amount/total_install end end) as d28,
sum(case when t1.retention_day=29 then case when total_amount is null then 0 else total_amount/total_install end end) as d29,
sum(case when t1.retention_day=30 then case when total_amount is null then 0 else total_amount/total_install end end) as d30,
sum(case when t1.retention_day=31 then case when total_amount is null then 0 else total_amount/total_install end end) as d31,
sum(case when t1.retention_day=32 then case when total_amount is null then 0 else total_amount/total_install end end) as d32,
sum(case when t1.retention_day=33 then case when total_amount is null then 0 else total_amount/total_install end end) as d33,
sum(case when t1.retention_day=34 then case when total_amount is null then 0 else total_amount/total_install end end) as d34,
sum(case when t1.retention_day=35 then case when total_amount is null then 0 else total_amount/total_install end end) as d35,
sum(case when t1.retention_day=36 then case when total_amount is null then 0 else total_amount/total_install end end) as d36,
sum(case when t1.retention_day=37 then case when total_amount is null then 0 else total_amount/total_install end end) as d37,
sum(case when t1.retention_day=38 then case when total_amount is null then 0 else total_amount/total_install end end) as d38,
sum(case when t1.retention_day=39 then case when total_amount is null then 0 else total_amount/total_install end end) as d39,
sum(case when t1.retention_day=40 then case when total_amount is null then 0 else total_amount/total_install end end) as d40,
sum(case when t1.retention_day=41 then case when total_amount is null then 0 else total_amount/total_install end end) as d41,
sum(case when t1.retention_day=42 then case when total_amount is null then 0 else total_amount/total_install end end) as d42,
sum(case when t1.retention_day=43 then case when total_amount is null then 0 else total_amount/total_install end end) as d43,
sum(case when t1.retention_day=44 then case when total_amount is null then 0 else total_amount/total_install end end) as d44,
sum(case when t1.retention_day=45 then case when total_amount is null then 0 else total_amount/total_install end end) as d45,
sum(case when t1.retention_day=46 then case when total_amount is null then 0 else total_amount/total_install end end) as d46,
sum(case when t1.retention_day=47 then case when total_amount is null then 0 else total_amount/total_install end end) as d47,
sum(case when t1.retention_day=48 then case when total_amount is null then 0 else total_amount/total_install end end) as d48,
sum(case when t1.retention_day=49 then case when total_amount is null then 0 else total_amount/total_install end end) as d49,
sum(case when t1.retention_day=50 then case when total_amount is null then 0 else total_amount/total_install end end) as d50,
sum(case when t1.retention_day=51 then case when total_amount is null then 0 else total_amount/total_install end end) as d51,
sum(case when t1.retention_day=52 then case when total_amount is null then 0 else total_amount/total_install end end) as d52,
sum(case when t1.retention_day=53 then case when total_amount is null then 0 else total_amount/total_install end end) as d53,
sum(case when t1.retention_day=54 then case when total_amount is null then 0 else total_amount/total_install end end) as d54,
sum(case when t1.retention_day=55 then case when total_amount is null then 0 else total_amount/total_install end end) as d55,
sum(case when t1.retention_day=56 then case when total_amount is null then 0 else total_amount/total_install end end) as d56,
sum(case when t1.retention_day=57 then case when total_amount is null then 0 else total_amount/total_install end end) as d57,
sum(case when t1.retention_day=58 then case when total_amount is null then 0 else total_amount/total_install end end) as d58,
sum(case when t1.retention_day=59 then case when total_amount is null then 0 else total_amount/total_install end end) as d59,
sum(case when t1.retention_day=60 then case when total_amount is null then 0 else total_amount/total_install end end) as d60,
sum(case when t1.retention_day=61 then case when total_amount is null then 0 else total_amount/total_install end end) as d61,
sum(case when t1.retention_day=62 then case when total_amount is null then 0 else total_amount/total_install end end) as d62,
sum(case when t1.retention_day=63 then case when total_amount is null then 0 else total_amount/total_install end end) as d63,
sum(case when t1.retention_day=64 then case when total_amount is null then 0 else total_amount/total_install end end) as d64,
sum(case when t1.retention_day=65 then case when total_amount is null then 0 else total_amount/total_install end end) as d65,
sum(case when t1.retention_day=66 then case when total_amount is null then 0 else total_amount/total_install end end) as d66,
sum(case when t1.retention_day=67 then case when total_amount is null then 0 else total_amount/total_install end end) as d67,
sum(case when t1.retention_day=68 then case when total_amount is null then 0 else total_amount/total_install end end) as d68,
sum(case when t1.retention_day=69 then case when total_amount is null then 0 else total_amount/total_install end end) as d69,
sum(case when t1.retention_day=70 then case when total_amount is null then 0 else total_amount/total_install end end) as d70,
sum(case when t1.retention_day=71 then case when total_amount is null then 0 else total_amount/total_install end end) as d71,
sum(case when t1.retention_day=72 then case when total_amount is null then 0 else total_amount/total_install end end) as d72,
sum(case when t1.retention_day=73 then case when total_amount is null then 0 else total_amount/total_install end end) as d73,
sum(case when t1.retention_day=74 then case when total_amount is null then 0 else total_amount/total_install end end) as d74,
sum(case when t1.retention_day=75 then case when total_amount is null then 0 else total_amount/total_install end end) as d75,
sum(case when t1.retention_day=76 then case when total_amount is null then 0 else total_amount/total_install end end) as d76,
sum(case when t1.retention_day=77 then case when total_amount is null then 0 else total_amount/total_install end end) as d77,
sum(case when t1.retention_day=78 then case when total_amount is null then 0 else total_amount/total_install end end) as d78,
sum(case when t1.retention_day=79 then case when total_amount is null then 0 else total_amount/total_install end end) as d79,
sum(case when t1.retention_day=80 then case when total_amount is null then 0 else total_amount/total_install end end) as d80,
sum(case when t1.retention_day=81 then case when total_amount is null then 0 else total_amount/total_install end end) as d81,
sum(case when t1.retention_day=82 then case when total_amount is null then 0 else total_amount/total_install end end) as d82,
sum(case when t1.retention_day=83 then case when total_amount is null then 0 else total_amount/total_install end end) as d83,
sum(case when t1.retention_day=84 then case when total_amount is null then 0 else total_amount/total_install end end) as d84,
sum(case when t1.retention_day=85 then case when total_amount is null then 0 else total_amount/total_install end end) as d85,
sum(case when t1.retention_day=86 then case when total_amount is null then 0 else total_amount/total_install end end) as d86,
sum(case when t1.retention_day=87 then case when total_amount is null then 0 else total_amount/total_install end end) as d87,
sum(case when t1.retention_day=88 then case when total_amount is null then 0 else total_amount/total_install end end) as d88,
sum(case when t1.retention_day=89 then case when total_amount is null then 0 else total_amount/total_install end end) as d89,
sum(case when t1.retention_day=90 then case when total_amount is null then 0 else total_amount/total_install end end) as d90


	
	from
(	select b.snid,b.gameid, b.retention_day,sum(b.total_amount) as total_amount
		from
		  (select * from user_retention_source_ltv
		  
	    
		      <if test="_parameter != null">
					<include refid="Vo_Where_Clause" />
					<![CDATA[ 
							and (retention_day >= 0 and retention_day <= 90) 
						]]>
			</if>
		  
		  )b
		group by b.snid,b.gameid, b.retention_day
	    order by b.snid,b.gameid,b.retention_day)t1
	left outer join 
	(select snid,gameid,retention_day,sum(install) as total_install
		from user_retention_source_ltv
		
   			<if test="_parameter != null">
					<include refid="Vo_Where_Clause" />
					
			</if>
   
group by snid,gameid,retention_day
)t2
on t1.snid=t2.snid and t1.gameid=t2.gameid and  t1.retention_day=t2.retention_day
group by t1.snid,t1.gameid
</select>
	<select id="selectHorizontal4RolePayList" parameterType="com.hoolai.bi.report.vo.UserRetentionLtvVO" resultMap="LifeResultMap">
	select a.*,b.role_choice as install from 
(
	select install_day,
		max(case retention_day when 0 then total_amount else 0 end) D0,
		max(case retention_day when 1 then total_amount else 0 end) D1,
		max(case retention_day when 2 then total_amount else 0 end) D2,
		max(case retention_day when 3 then total_amount else 0 end) D3,
		max(case retention_day when 4 then total_amount else 0 end) D4,
		max(case retention_day when 5 then total_amount else 0 end) D5,
		max(case retention_day when 6 then total_amount else 0 end) D6,
		max(case retention_day when 7 then total_amount else 0 end) D7,
		max(case retention_day when 8 then total_amount else 0 end) D8,
		max(case retention_day when 9 then total_amount else 0 end) D9,
		max(case retention_day when 10 then total_amount else 0 end) D10,
		max(case retention_day when 11 then total_amount else 0 end) D11,
		max(case retention_day when 12 then total_amount else 0 end) D12,
		max(case retention_day when 13 then total_amount else 0 end) D13,
		max(case retention_day when 14 then total_amount else 0 end) D14,
		max(case retention_day when 15 then total_amount else 0 end) D15,
		max(case retention_day when 16 then total_amount else 0 end) D16,
		max(case retention_day when 17 then total_amount else 0 end) D17,
		max(case retention_day when 18 then total_amount else 0 end) D18,
		max(case retention_day when 19 then total_amount else 0 end) D19,
		max(case retention_day when 20 then total_amount else 0 end) D20,
		max(case retention_day when 21 then total_amount else 0 end) D21,
		max(case retention_day when 22 then total_amount else 0 end) D22,
		max(case retention_day when 23 then total_amount else 0 end) D23,
		max(case retention_day when 24 then total_amount else 0 end) D24,
		max(case retention_day when 25 then total_amount else 0 end) D25,
		max(case retention_day when 26 then total_amount else 0 end) D26,
		max(case retention_day when 27 then total_amount else 0 end) D27,
		max(case retention_day when 28 then total_amount else 0 end) D28,
		max(case retention_day when 29 then total_amount else 0 end) D29,
		max(case retention_day when 30 then total_amount else 0 end) D30,
		max(case retention_day when 31 then total_amount else 0 end) D31,
		max(case retention_day when 32 then total_amount else 0 end) D32,
		max(case retention_day when 33 then total_amount else 0 end) D33,
		max(case retention_day when 34 then total_amount else 0 end) D34,
		max(case retention_day when 35 then total_amount else 0 end) D35,
		max(case retention_day when 36 then total_amount else 0 end) D36,
		max(case retention_day when 37 then total_amount else 0 end) D37,
		max(case retention_day when 38 then total_amount else 0 end) D38,
		max(case retention_day when 39 then total_amount else 0 end) D39,
		max(case retention_day when 40 then total_amount else 0 end) D40,
		max(case retention_day when 41 then total_amount else 0 end) D41,
		max(case retention_day when 42 then total_amount else 0 end) D42,
		max(case retention_day when 43 then total_amount else 0 end) D43,
		max(case retention_day when 44 then total_amount else 0 end) D44,
		max(case retention_day when 45 then total_amount else 0 end) D45,
		max(case retention_day when 46 then total_amount else 0 end) D46,
		max(case retention_day when 47 then total_amount else 0 end) D47,
		max(case retention_day when 48 then total_amount else 0 end) D48,
		max(case retention_day when 49 then total_amount else 0 end) D49,
		max(case retention_day when 50 then total_amount else 0 end) D50,
		max(case retention_day when 51 then total_amount else 0 end) D51,
		max(case retention_day when 52 then total_amount else 0 end) D52,
		max(case retention_day when 53 then total_amount else 0 end) D53,
		max(case retention_day when 54 then total_amount else 0 end) D54,
		max(case retention_day when 55 then total_amount else 0 end) D55,
		max(case retention_day when 56 then total_amount else 0 end) D56,
		max(case retention_day when 57 then total_amount else 0 end) D57,
		max(case retention_day when 58 then total_amount else 0 end) D58,
		max(case retention_day when 59 then total_amount else 0 end) D59,
		max(case retention_day when 60 then total_amount else 0 end) D60,
		max(case retention_day when 61 then total_amount else 0 end) D61,
		max(case retention_day when 62 then total_amount else 0 end) D62,
		max(case retention_day when 63 then total_amount else 0 end) D63,
		max(case retention_day when 64 then total_amount else 0 end) D64,
		max(case retention_day when 65 then total_amount else 0 end) D65,
		max(case retention_day when 66 then total_amount else 0 end) D66,
		max(case retention_day when 67 then total_amount else 0 end) D67,
		max(case retention_day when 68 then total_amount else 0 end) D68,
		max(case retention_day when 69 then total_amount else 0 end) D69,
		max(case retention_day when 70 then total_amount else 0 end) D70,
		max(case retention_day when 71 then total_amount else 0 end) D71,
		max(case retention_day when 72 then total_amount else 0 end) D72,
		max(case retention_day when 73 then total_amount else 0 end) D73,
		max(case retention_day when 74 then total_amount else 0 end) D74,
		max(case retention_day when 75 then total_amount else 0 end) D75,
		max(case retention_day when 76 then total_amount else 0 end) D76,
		max(case retention_day when 77 then total_amount else 0 end) D77,
		max(case retention_day when 78 then total_amount else 0 end) D78,
		max(case retention_day when 79 then total_amount else 0 end) D79,
		max(case retention_day when 80 then total_amount else 0 end) D80,
		max(case retention_day when 81 then total_amount else 0 end) D81,
		max(case retention_day when 82 then total_amount else 0 end) D82,
		max(case retention_day when 83 then total_amount else 0 end) D83,
		max(case retention_day when 84 then total_amount else 0 end) D84,
		max(case retention_day when 85 then total_amount else 0 end) D85,
		max(case retention_day when 86 then total_amount else 0 end) D86,
		max(case retention_day when 87 then total_amount else 0 end) D87,
		max(case retention_day when 88 then total_amount else 0 end) D88,
		max(case retention_day when 89 then total_amount else 0 end) D89,
		max(case retention_day when 90 then total_amount else 0 end) D90
	from user_retention_source_ltv 
	<if test="_parameter != null">
		<include refid="Vo_Where_Clause" />
		<![CDATA[ 
				and (retention_day >= 0 and retention_day <= 90) 
				group by install_day
			]]>
	</if>
) a
left outer join
(
	select day,role_choice
	from source_daily_report 
    <if test="_parameter != null">
		<include refid="Vo_Where_Clause_daily_report" />
	</if>
) b on a.install_day = b.day
</select>

<select id="selectHorizontal4TotalRolePayList" parameterType="com.hoolai.bi.report.vo.UserRetentionLtvVO" resultMap="LifeResultMap">

select total_install as install,
sum(case when t1.retention_day=0 then case when total_amount is null then 0 else total_amount end end) as d0,
sum(case when t1.retention_day=1 then case when total_amount is null then 0 else total_amount end end) as d1,
sum(case when t1.retention_day=2 then case when total_amount is null then 0 else total_amount end end) as d2,
sum(case when t1.retention_day=3 then case when total_amount is null then 0 else total_amount end end) as d3,
sum(case when t1.retention_day=4 then case when total_amount is null then 0 else total_amount end end) as d4,
sum(case when t1.retention_day=5 then case when total_amount is null then 0 else total_amount end end) as d5,
sum(case when t1.retention_day=6 then case when total_amount is null then 0 else total_amount end end) as d6,
sum(case when t1.retention_day=7 then case when total_amount is null then 0 else total_amount end end) as d7,
sum(case when t1.retention_day=8 then case when total_amount is null then 0 else total_amount end end) as d8,
sum(case when t1.retention_day=9 then case when total_amount is null then 0 else total_amount end end) as d9,
sum(case when t1.retention_day=10 then case when total_amount is null then 0 else total_amount end end) as d10,
sum(case when t1.retention_day=11 then case when total_amount is null then 0 else total_amount end end) as d11,
sum(case when t1.retention_day=12 then case when total_amount is null then 0 else total_amount end end) as d12,
sum(case when t1.retention_day=13 then case when total_amount is null then 0 else total_amount end end) as d13,
sum(case when t1.retention_day=14 then case when total_amount is null then 0 else total_amount end end) as d14,
sum(case when t1.retention_day=15 then case when total_amount is null then 0 else total_amount end end) as d15,
sum(case when t1.retention_day=16 then case when total_amount is null then 0 else total_amount end end) as d16,
sum(case when t1.retention_day=17 then case when total_amount is null then 0 else total_amount end end) as d17,
sum(case when t1.retention_day=18 then case when total_amount is null then 0 else total_amount end end) as d18,
sum(case when t1.retention_day=19 then case when total_amount is null then 0 else total_amount end end) as d19,
sum(case when t1.retention_day=20 then case when total_amount is null then 0 else total_amount end end) as d20,
sum(case when t1.retention_day=21 then case when total_amount is null then 0 else total_amount end end) as d21,
sum(case when t1.retention_day=22 then case when total_amount is null then 0 else total_amount end end) as d22,
sum(case when t1.retention_day=23 then case when total_amount is null then 0 else total_amount end end) as d23,
sum(case when t1.retention_day=24 then case when total_amount is null then 0 else total_amount end end) as d24,
sum(case when t1.retention_day=25 then case when total_amount is null then 0 else total_amount end end) as d25,
sum(case when t1.retention_day=26 then case when total_amount is null then 0 else total_amount end end) as d26,
sum(case when t1.retention_day=27 then case when total_amount is null then 0 else total_amount end end) as d27,
sum(case when t1.retention_day=28 then case when total_amount is null then 0 else total_amount end end) as d28,
sum(case when t1.retention_day=29 then case when total_amount is null then 0 else total_amount end end) as d29,
sum(case when t1.retention_day=30 then case when total_amount is null then 0 else total_amount end end) as d30,
sum(case when t1.retention_day=31 then case when total_amount is null then 0 else total_amount end end) as d31,
sum(case when t1.retention_day=32 then case when total_amount is null then 0 else total_amount end end) as d32,
sum(case when t1.retention_day=33 then case when total_amount is null then 0 else total_amount end end) as d33,
sum(case when t1.retention_day=34 then case when total_amount is null then 0 else total_amount end end) as d34,
sum(case when t1.retention_day=35 then case when total_amount is null then 0 else total_amount end end) as d35,
sum(case when t1.retention_day=36 then case when total_amount is null then 0 else total_amount end end) as d36,
sum(case when t1.retention_day=37 then case when total_amount is null then 0 else total_amount end end) as d37,
sum(case when t1.retention_day=38 then case when total_amount is null then 0 else total_amount end end) as d38,
sum(case when t1.retention_day=39 then case when total_amount is null then 0 else total_amount end end) as d39,
sum(case when t1.retention_day=40 then case when total_amount is null then 0 else total_amount end end) as d40,
sum(case when t1.retention_day=41 then case when total_amount is null then 0 else total_amount end end) as d41,
sum(case when t1.retention_day=42 then case when total_amount is null then 0 else total_amount end end) as d42,
sum(case when t1.retention_day=43 then case when total_amount is null then 0 else total_amount end end) as d43,
sum(case when t1.retention_day=44 then case when total_amount is null then 0 else total_amount end end) as d44,
sum(case when t1.retention_day=45 then case when total_amount is null then 0 else total_amount end end) as d45,
sum(case when t1.retention_day=46 then case when total_amount is null then 0 else total_amount end end) as d46,
sum(case when t1.retention_day=47 then case when total_amount is null then 0 else total_amount end end) as d47,
sum(case when t1.retention_day=48 then case when total_amount is null then 0 else total_amount end end) as d48,
sum(case when t1.retention_day=49 then case when total_amount is null then 0 else total_amount end end) as d49,
sum(case when t1.retention_day=50 then case when total_amount is null then 0 else total_amount end end) as d50,
sum(case when t1.retention_day=51 then case when total_amount is null then 0 else total_amount end end) as d51,
sum(case when t1.retention_day=52 then case when total_amount is null then 0 else total_amount end end) as d52,
sum(case when t1.retention_day=53 then case when total_amount is null then 0 else total_amount end end) as d53,
sum(case when t1.retention_day=54 then case when total_amount is null then 0 else total_amount end end) as d54,
sum(case when t1.retention_day=55 then case when total_amount is null then 0 else total_amount end end) as d55,
sum(case when t1.retention_day=56 then case when total_amount is null then 0 else total_amount end end) as d56,
sum(case when t1.retention_day=57 then case when total_amount is null then 0 else total_amount end end) as d57,
sum(case when t1.retention_day=58 then case when total_amount is null then 0 else total_amount end end) as d58,
sum(case when t1.retention_day=59 then case when total_amount is null then 0 else total_amount end end) as d59,
sum(case when t1.retention_day=60 then case when total_amount is null then 0 else total_amount end end) as d60,
sum(case when t1.retention_day=61 then case when total_amount is null then 0 else total_amount end end) as d61,
sum(case when t1.retention_day=62 then case when total_amount is null then 0 else total_amount end end) as d62,
sum(case when t1.retention_day=63 then case when total_amount is null then 0 else total_amount end end) as d63,
sum(case when t1.retention_day=64 then case when total_amount is null then 0 else total_amount end end) as d64,
sum(case when t1.retention_day=65 then case when total_amount is null then 0 else total_amount end end) as d65,
sum(case when t1.retention_day=66 then case when total_amount is null then 0 else total_amount end end) as d66,
sum(case when t1.retention_day=67 then case when total_amount is null then 0 else total_amount end end) as d67,
sum(case when t1.retention_day=68 then case when total_amount is null then 0 else total_amount end end) as d68,
sum(case when t1.retention_day=69 then case when total_amount is null then 0 else total_amount end end) as d69,
sum(case when t1.retention_day=70 then case when total_amount is null then 0 else total_amount end end) as d70,
sum(case when t1.retention_day=71 then case when total_amount is null then 0 else total_amount end end) as d71,
sum(case when t1.retention_day=72 then case when total_amount is null then 0 else total_amount end end) as d72,
sum(case when t1.retention_day=73 then case when total_amount is null then 0 else total_amount end end) as d73,
sum(case when t1.retention_day=74 then case when total_amount is null then 0 else total_amount end end) as d74,
sum(case when t1.retention_day=75 then case when total_amount is null then 0 else total_amount end end) as d75,
sum(case when t1.retention_day=76 then case when total_amount is null then 0 else total_amount end end) as d76,
sum(case when t1.retention_day=77 then case when total_amount is null then 0 else total_amount end end) as d77,
sum(case when t1.retention_day=78 then case when total_amount is null then 0 else total_amount end end) as d78,
sum(case when t1.retention_day=79 then case when total_amount is null then 0 else total_amount end end) as d79,
sum(case when t1.retention_day=80 then case when total_amount is null then 0 else total_amount end end) as d80,
sum(case when t1.retention_day=81 then case when total_amount is null then 0 else total_amount end end) as d81,
sum(case when t1.retention_day=82 then case when total_amount is null then 0 else total_amount end end) as d82,
sum(case when t1.retention_day=83 then case when total_amount is null then 0 else total_amount end end) as d83,
sum(case when t1.retention_day=84 then case when total_amount is null then 0 else total_amount end end) as d84,
sum(case when t1.retention_day=85 then case when total_amount is null then 0 else total_amount end end) as d85,
sum(case when t1.retention_day=86 then case when total_amount is null then 0 else total_amount end end) as d86,
sum(case when t1.retention_day=87 then case when total_amount is null then 0 else total_amount end end) as d87,
sum(case when t1.retention_day=88 then case when total_amount is null then 0 else total_amount end end) as d88,
sum(case when t1.retention_day=89 then case when total_amount is null then 0 else total_amount end end) as d89,
sum(case when t1.retention_day=90 then case when total_amount is null then 0 else total_amount end end) as d90

	from
	(select b.snid,b.gameid, b.retention_day,sum(b.total_amount) as total_amount
		from
		  (select * from user_retention_source_ltv 
	      <if test="_parameter != null">
			<include refid="Vo_Where_Clause" />
			<![CDATA[ 
					and (retention_day >= 0 and retention_day <= 90) 
					
				]]>
		</if>
	     
		  )b
		group by b.snid,b.gameid, b.retention_day
	    order by b.snid,b.gameid,b.retention_day)t1
	left outer join 
	(select snid,gameid,sum(role_choice) total_install
	from source_daily_report 
   <if test="_parameter != null">
		<include refid="Vo_Where_Clause_daily_report" />
	</if>
   
   group by snid,gameid)t2
	on t1.snid=t2.snid and t1.gameid=t2.gameid
group by total_install


</select>

<!--        -->
<select id="selectHorizontal4TotalRolePayList2" parameterType="com.hoolai.bi.report.vo.UserRetentionLtvVO" resultMap="LifeResultMap">

select t1.snid,t1.gameid,t3.total_choice as install,
sum(case when t1.retention_day=0 then case when total_amount is null then 0 else total_amount/total_install end  end) as d0,
sum(case when t1.retention_day=1 then case when total_amount is null then 0 else total_amount /total_install end end) as d1,
sum(case when t1.retention_day=2 then case when total_amount is null then 0 else total_amount /total_install end end) as d2,
sum(case when t1.retention_day=3 then case when total_amount is null then 0 else total_amount /total_install end end) as d3,
sum(case when t1.retention_day=4 then case when total_amount is null then 0 else total_amount /total_install end end) as d4,
sum(case when t1.retention_day=5 then case when total_amount is null then 0 else total_amount /total_install end end) as d5,
sum(case when t1.retention_day=6 then case when total_amount is null then 0 else total_amount /total_install end end) as d6,
sum(case when t1.retention_day=7 then case when total_amount is null then 0 else total_amount /total_install end end) as d7,
sum(case when t1.retention_day=8 then case when total_amount is null then 0 else total_amount /total_install end end) as d8,
sum(case when t1.retention_day=9 then case when total_amount is null then 0 else total_amount /total_install end end) as d9,
sum(case when t1.retention_day=10 then case when total_amount is null then 0 else total_amount/total_install end end) as d10,
sum(case when t1.retention_day=11 then case when total_amount is null then 0 else total_amount/total_install end end) as d11,
sum(case when t1.retention_day=12 then case when total_amount is null then 0 else total_amount/total_install end end) as d12,
sum(case when t1.retention_day=13 then case when total_amount is null then 0 else total_amount/total_install end end) as d13,
sum(case when t1.retention_day=14 then case when total_amount is null then 0 else total_amount/total_install end end) as d14,
sum(case when t1.retention_day=15 then case when total_amount is null then 0 else total_amount/total_install end end) as d15,
sum(case when t1.retention_day=16 then case when total_amount is null then 0 else total_amount/total_install end end) as d16,
sum(case when t1.retention_day=17 then case when total_amount is null then 0 else total_amount/total_install end end) as d17,
sum(case when t1.retention_day=18 then case when total_amount is null then 0 else total_amount/total_install end end) as d18,
sum(case when t1.retention_day=19 then case when total_amount is null then 0 else total_amount/total_install end end) as d19,
sum(case when t1.retention_day=20 then case when total_amount is null then 0 else total_amount/total_install end end) as d20,
sum(case when t1.retention_day=21 then case when total_amount is null then 0 else total_amount/total_install end end) as d21,
sum(case when t1.retention_day=22 then case when total_amount is null then 0 else total_amount/total_install end end) as d22,
sum(case when t1.retention_day=23 then case when total_amount is null then 0 else total_amount/total_install end end) as d23,
sum(case when t1.retention_day=24 then case when total_amount is null then 0 else total_amount/total_install end end) as d24,
sum(case when t1.retention_day=25 then case when total_amount is null then 0 else total_amount/total_install end end) as d25,
sum(case when t1.retention_day=26 then case when total_amount is null then 0 else total_amount/total_install end end) as d26,
sum(case when t1.retention_day=27 then case when total_amount is null then 0 else total_amount/total_install end end) as d27,
sum(case when t1.retention_day=28 then case when total_amount is null then 0 else total_amount/total_install end end) as d28,
sum(case when t1.retention_day=29 then case when total_amount is null then 0 else total_amount/total_install end end) as d29,
sum(case when t1.retention_day=30 then case when total_amount is null then 0 else total_amount/total_install end end) as d30,
sum(case when t1.retention_day=31 then case when total_amount is null then 0 else total_amount/total_install end end) as d31,
sum(case when t1.retention_day=32 then case when total_amount is null then 0 else total_amount/total_install end end) as d32,
sum(case when t1.retention_day=33 then case when total_amount is null then 0 else total_amount/total_install end end) as d33,
sum(case when t1.retention_day=34 then case when total_amount is null then 0 else total_amount/total_install end end) as d34,
sum(case when t1.retention_day=35 then case when total_amount is null then 0 else total_amount/total_install end end) as d35,
sum(case when t1.retention_day=36 then case when total_amount is null then 0 else total_amount/total_install end end) as d36,
sum(case when t1.retention_day=37 then case when total_amount is null then 0 else total_amount/total_install end end) as d37,
sum(case when t1.retention_day=38 then case when total_amount is null then 0 else total_amount/total_install end end) as d38,
sum(case when t1.retention_day=39 then case when total_amount is null then 0 else total_amount/total_install end end) as d39,
sum(case when t1.retention_day=40 then case when total_amount is null then 0 else total_amount/total_install end end) as d40,
sum(case when t1.retention_day=41 then case when total_amount is null then 0 else total_amount/total_install end end) as d41,
sum(case when t1.retention_day=42 then case when total_amount is null then 0 else total_amount/total_install end end) as d42,
sum(case when t1.retention_day=43 then case when total_amount is null then 0 else total_amount/total_install end end) as d43,
sum(case when t1.retention_day=44 then case when total_amount is null then 0 else total_amount/total_install end end) as d44,
sum(case when t1.retention_day=45 then case when total_amount is null then 0 else total_amount/total_install end end) as d45,
sum(case when t1.retention_day=46 then case when total_amount is null then 0 else total_amount/total_install end end) as d46,
sum(case when t1.retention_day=47 then case when total_amount is null then 0 else total_amount/total_install end end) as d47,
sum(case when t1.retention_day=48 then case when total_amount is null then 0 else total_amount/total_install end end) as d48,
sum(case when t1.retention_day=49 then case when total_amount is null then 0 else total_amount/total_install end end) as d49,
sum(case when t1.retention_day=50 then case when total_amount is null then 0 else total_amount/total_install end end) as d50,
sum(case when t1.retention_day=51 then case when total_amount is null then 0 else total_amount/total_install end end) as d51,
sum(case when t1.retention_day=52 then case when total_amount is null then 0 else total_amount/total_install end end) as d52,
sum(case when t1.retention_day=53 then case when total_amount is null then 0 else total_amount/total_install end end) as d53,
sum(case when t1.retention_day=54 then case when total_amount is null then 0 else total_amount/total_install end end) as d54,
sum(case when t1.retention_day=55 then case when total_amount is null then 0 else total_amount/total_install end end) as d55,
sum(case when t1.retention_day=56 then case when total_amount is null then 0 else total_amount/total_install end end) as d56,
sum(case when t1.retention_day=57 then case when total_amount is null then 0 else total_amount/total_install end end) as d57,
sum(case when t1.retention_day=58 then case when total_amount is null then 0 else total_amount/total_install end end) as d58,
sum(case when t1.retention_day=59 then case when total_amount is null then 0 else total_amount/total_install end end) as d59,
sum(case when t1.retention_day=60 then case when total_amount is null then 0 else total_amount/total_install end end) as d60,
sum(case when t1.retention_day=61 then case when total_amount is null then 0 else total_amount/total_install end end) as d61,
sum(case when t1.retention_day=62 then case when total_amount is null then 0 else total_amount/total_install end end) as d62,
sum(case when t1.retention_day=63 then case when total_amount is null then 0 else total_amount/total_install end end) as d63,
sum(case when t1.retention_day=64 then case when total_amount is null then 0 else total_amount/total_install end end) as d64,
sum(case when t1.retention_day=65 then case when total_amount is null then 0 else total_amount/total_install end end) as d65,
sum(case when t1.retention_day=66 then case when total_amount is null then 0 else total_amount/total_install end end) as d66,
sum(case when t1.retention_day=67 then case when total_amount is null then 0 else total_amount/total_install end end) as d67,
sum(case when t1.retention_day=68 then case when total_amount is null then 0 else total_amount/total_install end end) as d68,
sum(case when t1.retention_day=69 then case when total_amount is null then 0 else total_amount/total_install end end) as d69,
sum(case when t1.retention_day=70 then case when total_amount is null then 0 else total_amount/total_install end end) as d70,
sum(case when t1.retention_day=71 then case when total_amount is null then 0 else total_amount/total_install end end) as d71,
sum(case when t1.retention_day=72 then case when total_amount is null then 0 else total_amount/total_install end end) as d72,
sum(case when t1.retention_day=73 then case when total_amount is null then 0 else total_amount/total_install end end) as d73,
sum(case when t1.retention_day=74 then case when total_amount is null then 0 else total_amount/total_install end end) as d74,
sum(case when t1.retention_day=75 then case when total_amount is null then 0 else total_amount/total_install end end) as d75,
sum(case when t1.retention_day=76 then case when total_amount is null then 0 else total_amount/total_install end end) as d76,
sum(case when t1.retention_day=77 then case when total_amount is null then 0 else total_amount/total_install end end) as d77,
sum(case when t1.retention_day=78 then case when total_amount is null then 0 else total_amount/total_install end end) as d78,
sum(case when t1.retention_day=79 then case when total_amount is null then 0 else total_amount/total_install end end) as d79,
sum(case when t1.retention_day=80 then case when total_amount is null then 0 else total_amount/total_install end end) as d80,
sum(case when t1.retention_day=81 then case when total_amount is null then 0 else total_amount/total_install end end) as d81,
sum(case when t1.retention_day=82 then case when total_amount is null then 0 else total_amount/total_install end end) as d82,
sum(case when t1.retention_day=83 then case when total_amount is null then 0 else total_amount/total_install end end) as d83,
sum(case when t1.retention_day=84 then case when total_amount is null then 0 else total_amount/total_install end end) as d84,
sum(case when t1.retention_day=85 then case when total_amount is null then 0 else total_amount/total_install end end) as d85,
sum(case when t1.retention_day=86 then case when total_amount is null then 0 else total_amount/total_install end end) as d86,
sum(case when t1.retention_day=87 then case when total_amount is null then 0 else total_amount/total_install end end) as d87,
sum(case when t1.retention_day=88 then case when total_amount is null then 0 else total_amount/total_install end end) as d88,
sum(case when t1.retention_day=89 then case when total_amount is null then 0 else total_amount/total_install end end) as d89,
sum(case when t1.retention_day=90 then case when total_amount is null then 0 else total_amount/total_install end end) as d90

	from
	(select b.snid,b.gameid, b.retention_day,sum(b.total_amount) as total_amount
	from 
		  (select * from user_retention_source_ltv 
	      
	       <if test="_parameter != null">
				<include refid="Vo_Where_Clause" />
				<![CDATA[ 
						and (retention_day >= 0 and retention_day <= 90) 
						
					]]>
			</if>
			
		  )b
		group by b.snid,b.gameid, b.retention_day
	    order by b.snid,b.gameid,b.retention_day)t1
	left outer join 
	
	
	(select snid,gameid,retention_day,sum(install) as total_install
		from user_retention_source_ltv 
   
 		<if test="_parameter != null">
				<include refid="Vo_Where_Clause" />
		</if>	
   
   group by snid,gameid,retention_day)t2
		on t1.snid=t2.snid and t1.gameid=t2.gameid and  t1.retention_day=t2.retention_day
	 left outer join 
  ( select snid,gameid,sum(role_choice) as total_choice
  from   source_daily_report
   
 		 <if test="_parameter != null">
				<include refid="Vo_Where_Clause_daily_report" />
		</if>	
   
   group by snid,gameid)t3
  on t1.snid=t3.snid and t1.gameid=t3.gameid	
		
group by  t1.snid,t1.gameid



</select>

<select id="selectAllInstallCount" parameterType="com.hoolai.bi.report.vo.UserRetentionLtvVO" resultType="java.lang.Long">
   select count(1) from
	(select install_day,source from user_retention_source_ltv
	<if test="_parameter != null">
		<include refid="Vo_Where_Clause" />
	</if>
	<if test="searchValue != null">
		and (install_day like concat('%', #{searchValue}, '%') or source like concat('%', #{searchValue}, '%'))
	</if>
	group by install_day,source
	) a
</select>

<select id="selectAllInstallPayList" parameterType="com.hoolai.bi.report.vo.UserRetentionLtvVO" resultMap="LifeResultMap">
   select install_day,max(install) install,source,
		max(case retention_day when 0 then total_amount else 0 end) D0,
		max(case retention_day when 1 then total_amount else 0 end) D1,
		max(case retention_day when 2 then total_amount else 0 end) D2,
		max(case retention_day when 3 then total_amount else 0 end) D3,
		max(case retention_day when 4 then total_amount else 0 end) D4,
		max(case retention_day when 5 then total_amount else 0 end) D5,
		max(case retention_day when 6 then total_amount else 0 end) D6,
		max(case retention_day when 7 then total_amount else 0 end) D7,
		max(case retention_day when 8 then total_amount else 0 end) D8,
		max(case retention_day when 9 then total_amount else 0 end) D9,
		max(case retention_day when 10 then total_amount else 0 end) D10,
		max(case retention_day when 11 then total_amount else 0 end) D11,
		max(case retention_day when 12 then total_amount else 0 end) D12,
		max(case retention_day when 13 then total_amount else 0 end) D13,
		max(case retention_day when 14 then total_amount else 0 end) D14,
		max(case retention_day when 15 then total_amount else 0 end) D15,
		max(case retention_day when 16 then total_amount else 0 end) D16,
		max(case retention_day when 17 then total_amount else 0 end) D17,
		max(case retention_day when 18 then total_amount else 0 end) D18,
		max(case retention_day when 19 then total_amount else 0 end) D19,
		max(case retention_day when 20 then total_amount else 0 end) D20,
		max(case retention_day when 21 then total_amount else 0 end) D21,
		max(case retention_day when 22 then total_amount else 0 end) D22,
		max(case retention_day when 23 then total_amount else 0 end) D23,
		max(case retention_day when 24 then total_amount else 0 end) D24,
		max(case retention_day when 25 then total_amount else 0 end) D25,
		max(case retention_day when 26 then total_amount else 0 end) D26,
		max(case retention_day when 27 then total_amount else 0 end) D27,
		max(case retention_day when 28 then total_amount else 0 end) D28,
		max(case retention_day when 29 then total_amount else 0 end) D29,
		max(case retention_day when 30 then total_amount else 0 end) D30,
		max(case retention_day when 31 then total_amount else 0 end) D31,
		max(case retention_day when 32 then total_amount else 0 end) D32,
		max(case retention_day when 33 then total_amount else 0 end) D33,
		max(case retention_day when 34 then total_amount else 0 end) D34,
		max(case retention_day when 35 then total_amount else 0 end) D35,
		max(case retention_day when 36 then total_amount else 0 end) D36,
		max(case retention_day when 37 then total_amount else 0 end) D37,
		max(case retention_day when 38 then total_amount else 0 end) D38,
		max(case retention_day when 39 then total_amount else 0 end) D39,
		max(case retention_day when 40 then total_amount else 0 end) D40,
		max(case retention_day when 41 then total_amount else 0 end) D41,
		max(case retention_day when 42 then total_amount else 0 end) D42,
		max(case retention_day when 43 then total_amount else 0 end) D43,
		max(case retention_day when 44 then total_amount else 0 end) D44,
		max(case retention_day when 45 then total_amount else 0 end) D45,
		max(case retention_day when 46 then total_amount else 0 end) D46,
		max(case retention_day when 47 then total_amount else 0 end) D47,
		max(case retention_day when 48 then total_amount else 0 end) D48,
		max(case retention_day when 49 then total_amount else 0 end) D49,
		max(case retention_day when 50 then total_amount else 0 end) D50,
		max(case retention_day when 51 then total_amount else 0 end) D51,
		max(case retention_day when 52 then total_amount else 0 end) D52,
		max(case retention_day when 53 then total_amount else 0 end) D53,
		max(case retention_day when 54 then total_amount else 0 end) D54,
		max(case retention_day when 55 then total_amount else 0 end) D55,
		max(case retention_day when 56 then total_amount else 0 end) D56,
		max(case retention_day when 57 then total_amount else 0 end) D57,
		max(case retention_day when 58 then total_amount else 0 end) D58,
		max(case retention_day when 59 then total_amount else 0 end) D59,
		max(case retention_day when 60 then total_amount else 0 end) D60,
		max(case retention_day when 61 then total_amount else 0 end) D61,
		max(case retention_day when 62 then total_amount else 0 end) D62,
		max(case retention_day when 63 then total_amount else 0 end) D63,
		max(case retention_day when 64 then total_amount else 0 end) D64,
		max(case retention_day when 65 then total_amount else 0 end) D65,
		max(case retention_day when 66 then total_amount else 0 end) D66,
		max(case retention_day when 67 then total_amount else 0 end) D67,
		max(case retention_day when 68 then total_amount else 0 end) D68,
		max(case retention_day when 69 then total_amount else 0 end) D69,
		max(case retention_day when 70 then total_amount else 0 end) D70,
		max(case retention_day when 71 then total_amount else 0 end) D71,
		max(case retention_day when 72 then total_amount else 0 end) D72,
		max(case retention_day when 73 then total_amount else 0 end) D73,
		max(case retention_day when 74 then total_amount else 0 end) D74,
		max(case retention_day when 75 then total_amount else 0 end) D75,
		max(case retention_day when 76 then total_amount else 0 end) D76,
		max(case retention_day when 77 then total_amount else 0 end) D77,
		max(case retention_day when 78 then total_amount else 0 end) D78,
		max(case retention_day when 79 then total_amount else 0 end) D79,
		max(case retention_day when 80 then total_amount else 0 end) D80,
		max(case retention_day when 81 then total_amount else 0 end) D81,
		max(case retention_day when 82 then total_amount else 0 end) D82,
		max(case retention_day when 83 then total_amount else 0 end) D83,
		max(case retention_day when 84 then total_amount else 0 end) D84,
		max(case retention_day when 85 then total_amount else 0 end) D85,
		max(case retention_day when 86 then total_amount else 0 end) D86,
		max(case retention_day when 87 then total_amount else 0 end) D87,
		max(case retention_day when 88 then total_amount else 0 end) D88,
		max(case retention_day when 89 then total_amount else 0 end) D89,
		max(case retention_day when 90 then total_amount else 0 end) D90
	from user_retention_source_ltv 
	<if test="_parameter != null">
		<include refid="Vo_Where_Clause" />
		<![CDATA[ 
				and (retention_day >= 0 and retention_day <= 90) 
			]]>
	</if>
	<if test="searchValue != null">
	    and (install_day like concat('%', #{searchValue}, '%') or source like concat('%', #{searchValue}, '%'))
	 </if>
	 <![CDATA[ 
		group by install_day,source
		order by install_day desc
	]]>
	limit #{offset},#{rows}
</select>

<select id="selectAllRolePayList" parameterType="com.hoolai.bi.report.vo.UserRetentionLtvVO" resultMap="LifeResultMap">
   select a.*,b.role_choice as install from 
(
	select install_day,source,
		max(case retention_day when 0 then total_amount else 0 end) D0,
		max(case retention_day when 1 then total_amount else 0 end) D1,
		max(case retention_day when 2 then total_amount else 0 end) D2,
		max(case retention_day when 3 then total_amount else 0 end) D3,
		max(case retention_day when 4 then total_amount else 0 end) D4,
		max(case retention_day when 5 then total_amount else 0 end) D5,
		max(case retention_day when 6 then total_amount else 0 end) D6,
		max(case retention_day when 7 then total_amount else 0 end) D7,
		max(case retention_day when 8 then total_amount else 0 end) D8,
		max(case retention_day when 9 then total_amount else 0 end) D9,
		max(case retention_day when 10 then total_amount else 0 end) D10,
		max(case retention_day when 11 then total_amount else 0 end) D11,
		max(case retention_day when 12 then total_amount else 0 end) D12,
		max(case retention_day when 13 then total_amount else 0 end) D13,
		max(case retention_day when 14 then total_amount else 0 end) D14,
		max(case retention_day when 15 then total_amount else 0 end) D15,
		max(case retention_day when 16 then total_amount else 0 end) D16,
		max(case retention_day when 17 then total_amount else 0 end) D17,
		max(case retention_day when 18 then total_amount else 0 end) D18,
		max(case retention_day when 19 then total_amount else 0 end) D19,
		max(case retention_day when 20 then total_amount else 0 end) D20,
		max(case retention_day when 21 then total_amount else 0 end) D21,
		max(case retention_day when 22 then total_amount else 0 end) D22,
		max(case retention_day when 23 then total_amount else 0 end) D23,
		max(case retention_day when 24 then total_amount else 0 end) D24,
		max(case retention_day when 25 then total_amount else 0 end) D25,
		max(case retention_day when 26 then total_amount else 0 end) D26,
		max(case retention_day when 27 then total_amount else 0 end) D27,
		max(case retention_day when 28 then total_amount else 0 end) D28,
		max(case retention_day when 29 then total_amount else 0 end) D29,
		max(case retention_day when 30 then total_amount else 0 end) D30,
		max(case retention_day when 31 then total_amount else 0 end) D31,
		max(case retention_day when 32 then total_amount else 0 end) D32,
		max(case retention_day when 33 then total_amount else 0 end) D33,
		max(case retention_day when 34 then total_amount else 0 end) D34,
		max(case retention_day when 35 then total_amount else 0 end) D35,
		max(case retention_day when 36 then total_amount else 0 end) D36,
		max(case retention_day when 37 then total_amount else 0 end) D37,
		max(case retention_day when 38 then total_amount else 0 end) D38,
		max(case retention_day when 39 then total_amount else 0 end) D39,
		max(case retention_day when 40 then total_amount else 0 end) D40,
		max(case retention_day when 41 then total_amount else 0 end) D41,
		max(case retention_day when 42 then total_amount else 0 end) D42,
		max(case retention_day when 43 then total_amount else 0 end) D43,
		max(case retention_day when 44 then total_amount else 0 end) D44,
		max(case retention_day when 45 then total_amount else 0 end) D45,
		max(case retention_day when 46 then total_amount else 0 end) D46,
		max(case retention_day when 47 then total_amount else 0 end) D47,
		max(case retention_day when 48 then total_amount else 0 end) D48,
		max(case retention_day when 49 then total_amount else 0 end) D49,
		max(case retention_day when 50 then total_amount else 0 end) D50,
		max(case retention_day when 51 then total_amount else 0 end) D51,
		max(case retention_day when 52 then total_amount else 0 end) D52,
		max(case retention_day when 53 then total_amount else 0 end) D53,
		max(case retention_day when 54 then total_amount else 0 end) D54,
		max(case retention_day when 55 then total_amount else 0 end) D55,
		max(case retention_day when 56 then total_amount else 0 end) D56,
		max(case retention_day when 57 then total_amount else 0 end) D57,
		max(case retention_day when 58 then total_amount else 0 end) D58,
		max(case retention_day when 59 then total_amount else 0 end) D59,
		max(case retention_day when 60 then total_amount else 0 end) D60,
		max(case retention_day when 61 then total_amount else 0 end) D61,
		max(case retention_day when 62 then total_amount else 0 end) D62,
		max(case retention_day when 63 then total_amount else 0 end) D63,
		max(case retention_day when 64 then total_amount else 0 end) D64,
		max(case retention_day when 65 then total_amount else 0 end) D65,
		max(case retention_day when 66 then total_amount else 0 end) D66,
		max(case retention_day when 67 then total_amount else 0 end) D67,
		max(case retention_day when 68 then total_amount else 0 end) D68,
		max(case retention_day when 69 then total_amount else 0 end) D69,
		max(case retention_day when 70 then total_amount else 0 end) D70,
		max(case retention_day when 71 then total_amount else 0 end) D71,
		max(case retention_day when 72 then total_amount else 0 end) D72,
		max(case retention_day when 73 then total_amount else 0 end) D73,
		max(case retention_day when 74 then total_amount else 0 end) D74,
		max(case retention_day when 75 then total_amount else 0 end) D75,
		max(case retention_day when 76 then total_amount else 0 end) D76,
		max(case retention_day when 77 then total_amount else 0 end) D77,
		max(case retention_day when 78 then total_amount else 0 end) D78,
		max(case retention_day when 79 then total_amount else 0 end) D79,
		max(case retention_day when 80 then total_amount else 0 end) D80,
		max(case retention_day when 81 then total_amount else 0 end) D81,
		max(case retention_day when 82 then total_amount else 0 end) D82,
		max(case retention_day when 83 then total_amount else 0 end) D83,
		max(case retention_day when 84 then total_amount else 0 end) D84,
		max(case retention_day when 85 then total_amount else 0 end) D85,
		max(case retention_day when 86 then total_amount else 0 end) D86,
		max(case retention_day when 87 then total_amount else 0 end) D87,
		max(case retention_day when 88 then total_amount else 0 end) D88,
		max(case retention_day when 89 then total_amount else 0 end) D89,
		max(case retention_day when 90 then total_amount else 0 end) D90
	from user_retention_source_ltv 
	<if test="_parameter != null">
		<include refid="Vo_Where_Clause" />
		<![CDATA[ 
				and (retention_day >= 0 and retention_day <= 90) 
			]]>
	</if>
	<if test="searchValue != null">
	    and (install_day like concat('%', #{searchValue}, '%') or source like concat('%', #{searchValue}, '%'))
	 </if>
	 group by install_day,source
) a
left outer join
(
	select day,role_choice,source
	from source_daily_report 
    <if test="_parameter != null">
		<include refid="Vo_Where_Clause_daily_report" />
	</if>
) b on a.install_day = b.day and a.source = b.source
order by install_day desc
limit #{offset},#{rows}
</select>

<!--    -   -->
<select id="selectAllRolePayList_export" parameterType="com.hoolai.bi.report.vo.UserRetentionLtvVO" resultMap="LifeResultMap">
 select t1.snid,t1.gameid,
sum(case when t1.retention_day=0 then total_install end) as install,
sum(case when t1.retention_day=0 then case when total_amount is null then 0 else total_amount/total_install end  end) as d0,
sum(case when t1.retention_day=1 then case when total_amount is null then 0 else total_amount /total_install end end) as d1,
sum(case when t1.retention_day=2 then case when total_amount is null then 0 else total_amount /total_install end end) as d2,
sum(case when t1.retention_day=3 then case when total_amount is null then 0 else total_amount /total_install end end) as d3,
sum(case when t1.retention_day=4 then case when total_amount is null then 0 else total_amount /total_install end end) as d4,
sum(case when t1.retention_day=5 then case when total_amount is null then 0 else total_amount /total_install end end) as d5,
sum(case when t1.retention_day=6 then case when total_amount is null then 0 else total_amount /total_install end end) as d6,
sum(case when t1.retention_day=7 then case when total_amount is null then 0 else total_amount /total_install end end) as d7,
sum(case when t1.retention_day=8 then case when total_amount is null then 0 else total_amount /total_install end end) as d8,
sum(case when t1.retention_day=9 then case when total_amount is null then 0 else total_amount /total_install end end) as d9,
sum(case when t1.retention_day=10 then case when total_amount is null then 0 else total_amount/total_install end end) as d10,
sum(case when t1.retention_day=11 then case when total_amount is null then 0 else total_amount/total_install end end) as d11,
sum(case when t1.retention_day=12 then case when total_amount is null then 0 else total_amount/total_install end end) as d12,
sum(case when t1.retention_day=13 then case when total_amount is null then 0 else total_amount/total_install end end) as d13,
sum(case when t1.retention_day=14 then case when total_amount is null then 0 else total_amount/total_install end end) as d14,
sum(case when t1.retention_day=15 then case when total_amount is null then 0 else total_amount/total_install end end) as d15,
sum(case when t1.retention_day=16 then case when total_amount is null then 0 else total_amount/total_install end end) as d16,
sum(case when t1.retention_day=17 then case when total_amount is null then 0 else total_amount/total_install end end) as d17,
sum(case when t1.retention_day=18 then case when total_amount is null then 0 else total_amount/total_install end end) as d18,
sum(case when t1.retention_day=19 then case when total_amount is null then 0 else total_amount/total_install end end) as d19,
sum(case when t1.retention_day=20 then case when total_amount is null then 0 else total_amount/total_install end end) as d20,
sum(case when t1.retention_day=21 then case when total_amount is null then 0 else total_amount/total_install end end) as d21,
sum(case when t1.retention_day=22 then case when total_amount is null then 0 else total_amount/total_install end end) as d22,
sum(case when t1.retention_day=23 then case when total_amount is null then 0 else total_amount/total_install end end) as d23,
sum(case when t1.retention_day=24 then case when total_amount is null then 0 else total_amount/total_install end end) as d24,
sum(case when t1.retention_day=25 then case when total_amount is null then 0 else total_amount/total_install end end) as d25,
sum(case when t1.retention_day=26 then case when total_amount is null then 0 else total_amount/total_install end end) as d26,
sum(case when t1.retention_day=27 then case when total_amount is null then 0 else total_amount/total_install end end) as d27,
sum(case when t1.retention_day=28 then case when total_amount is null then 0 else total_amount/total_install end end) as d28,
sum(case when t1.retention_day=29 then case when total_amount is null then 0 else total_amount/total_install end end) as d29,
sum(case when t1.retention_day=30 then case when total_amount is null then 0 else total_amount/total_install end end) as d30,
sum(case when t1.retention_day=31 then case when total_amount is null then 0 else total_amount/total_install end end) as d31,
sum(case when t1.retention_day=32 then case when total_amount is null then 0 else total_amount/total_install end end) as d32,
sum(case when t1.retention_day=33 then case when total_amount is null then 0 else total_amount/total_install end end) as d33,
sum(case when t1.retention_day=34 then case when total_amount is null then 0 else total_amount/total_install end end) as d34,
sum(case when t1.retention_day=35 then case when total_amount is null then 0 else total_amount/total_install end end) as d35,
sum(case when t1.retention_day=36 then case when total_amount is null then 0 else total_amount/total_install end end) as d36,
sum(case when t1.retention_day=37 then case when total_amount is null then 0 else total_amount/total_install end end) as d37,
sum(case when t1.retention_day=38 then case when total_amount is null then 0 else total_amount/total_install end end) as d38,
sum(case when t1.retention_day=39 then case when total_amount is null then 0 else total_amount/total_install end end) as d39,
sum(case when t1.retention_day=40 then case when total_amount is null then 0 else total_amount/total_install end end) as d40,
sum(case when t1.retention_day=41 then case when total_amount is null then 0 else total_amount/total_install end end) as d41,
sum(case when t1.retention_day=42 then case when total_amount is null then 0 else total_amount/total_install end end) as d42,
sum(case when t1.retention_day=43 then case when total_amount is null then 0 else total_amount/total_install end end) as d43,
sum(case when t1.retention_day=44 then case when total_amount is null then 0 else total_amount/total_install end end) as d44,
sum(case when t1.retention_day=45 then case when total_amount is null then 0 else total_amount/total_install end end) as d45,
sum(case when t1.retention_day=46 then case when total_amount is null then 0 else total_amount/total_install end end) as d46,
sum(case when t1.retention_day=47 then case when total_amount is null then 0 else total_amount/total_install end end) as d47,
sum(case when t1.retention_day=48 then case when total_amount is null then 0 else total_amount/total_install end end) as d48,
sum(case when t1.retention_day=49 then case when total_amount is null then 0 else total_amount/total_install end end) as d49,
sum(case when t1.retention_day=50 then case when total_amount is null then 0 else total_amount/total_install end end) as d50,
sum(case when t1.retention_day=51 then case when total_amount is null then 0 else total_amount/total_install end end) as d51,
sum(case when t1.retention_day=52 then case when total_amount is null then 0 else total_amount/total_install end end) as d52,
sum(case when t1.retention_day=53 then case when total_amount is null then 0 else total_amount/total_install end end) as d53,
sum(case when t1.retention_day=54 then case when total_amount is null then 0 else total_amount/total_install end end) as d54,
sum(case when t1.retention_day=55 then case when total_amount is null then 0 else total_amount/total_install end end) as d55,
sum(case when t1.retention_day=56 then case when total_amount is null then 0 else total_amount/total_install end end) as d56,
sum(case when t1.retention_day=57 then case when total_amount is null then 0 else total_amount/total_install end end) as d57,
sum(case when t1.retention_day=58 then case when total_amount is null then 0 else total_amount/total_install end end) as d58,
sum(case when t1.retention_day=59 then case when total_amount is null then 0 else total_amount/total_install end end) as d59,
sum(case when t1.retention_day=60 then case when total_amount is null then 0 else total_amount/total_install end end) as d60,
sum(case when t1.retention_day=61 then case when total_amount is null then 0 else total_amount/total_install end end) as d61,
sum(case when t1.retention_day=62 then case when total_amount is null then 0 else total_amount/total_install end end) as d62,
sum(case when t1.retention_day=63 then case when total_amount is null then 0 else total_amount/total_install end end) as d63,
sum(case when t1.retention_day=64 then case when total_amount is null then 0 else total_amount/total_install end end) as d64,
sum(case when t1.retention_day=65 then case when total_amount is null then 0 else total_amount/total_install end end) as d65,
sum(case when t1.retention_day=66 then case when total_amount is null then 0 else total_amount/total_install end end) as d66,
sum(case when t1.retention_day=67 then case when total_amount is null then 0 else total_amount/total_install end end) as d67,
sum(case when t1.retention_day=68 then case when total_amount is null then 0 else total_amount/total_install end end) as d68,
sum(case when t1.retention_day=69 then case when total_amount is null then 0 else total_amount/total_install end end) as d69,
sum(case when t1.retention_day=70 then case when total_amount is null then 0 else total_amount/total_install end end) as d70,
sum(case when t1.retention_day=71 then case when total_amount is null then 0 else total_amount/total_install end end) as d71,
sum(case when t1.retention_day=72 then case when total_amount is null then 0 else total_amount/total_install end end) as d72,
sum(case when t1.retention_day=73 then case when total_amount is null then 0 else total_amount/total_install end end) as d73,
sum(case when t1.retention_day=74 then case when total_amount is null then 0 else total_amount/total_install end end) as d74,
sum(case when t1.retention_day=75 then case when total_amount is null then 0 else total_amount/total_install end end) as d75,
sum(case when t1.retention_day=76 then case when total_amount is null then 0 else total_amount/total_install end end) as d76,
sum(case when t1.retention_day=77 then case when total_amount is null then 0 else total_amount/total_install end end) as d77,
sum(case when t1.retention_day=78 then case when total_amount is null then 0 else total_amount/total_install end end) as d78,
sum(case when t1.retention_day=79 then case when total_amount is null then 0 else total_amount/total_install end end) as d79,
sum(case when t1.retention_day=80 then case when total_amount is null then 0 else total_amount/total_install end end) as d80,
sum(case when t1.retention_day=81 then case when total_amount is null then 0 else total_amount/total_install end end) as d81,
sum(case when t1.retention_day=82 then case when total_amount is null then 0 else total_amount/total_install end end) as d82,
sum(case when t1.retention_day=83 then case when total_amount is null then 0 else total_amount/total_install end end) as d83,
sum(case when t1.retention_day=84 then case when total_amount is null then 0 else total_amount/total_install end end) as d84,
sum(case when t1.retention_day=85 then case when total_amount is null then 0 else total_amount/total_install end end) as d85,
sum(case when t1.retention_day=86 then case when total_amount is null then 0 else total_amount/total_install end end) as d86,
sum(case when t1.retention_day=87 then case when total_amount is null then 0 else total_amount/total_install end end) as d87,
sum(case when t1.retention_day=88 then case when total_amount is null then 0 else total_amount/total_install end end) as d88,
sum(case when t1.retention_day=89 then case when total_amount is null then 0 else total_amount/total_install end end) as d89,
sum(case when t1.retention_day=90 then case when total_amount is null then 0 else total_amount/total_install end end) as d90

	from
	(select b.snid,b.gameid, b.retention_day,sum(b.total_amount) as total_amount
	from 
		  (select * from user_retention_source_ltv 
	     
		 <if test="_parameter != null">
				<include refid="Vo_Where_Clause" />
				<![CDATA[ 
					and (retention_day >= 0 and retention_day <= 90) 
				]]>
		</if>
		 
			
		  )b
		group by b.snid,b.gameid, b.retention_day
	    order by b.snid,b.gameid,b.retention_day)t1
	left outer join 
	
	
	
	(select t2.snid,t2.gameid,t2.day,datediff(t3.max_day ,day) retention_day,total_install
	from 
	
	(select snid,gameid,day,
	case  when @preVal = t.snid then @curVal := @curVal + t.role_choice  
          when @preVal := t.snid then @curVal := t.role_choice  
       end AS total_install  
		from source_daily_report t,(select @preVal:=null, @curVal:=null) r  
   
   <if test="_parameter != null">
		<include refid="Vo_Where_Clause_daily_report" />
	</if>
   
   
	order by t.day asc)t2
	left outer join 
	(select snid,gameid,max(day) max_day
		from source_daily_report
		
	 <if test="_parameter != null">
		<include refid="Vo_Where_Clause_daily_report" />
	</if>
	group by snid,gameid)t3
   on 	t2.snid=t3.snid and t2.gameid=t3.gameid)t2
		on t1.snid=t2.snid and t1.gameid=t2.gameid and  t1.retention_day=t2.retention_day
group by  t1.snid,t1.gameid

</select>
<select id="selectAllInstallRetentionList" parameterType="com.hoolai.bi.report.vo.UserRetentionLtvVO" resultMap="LifeResultMap">
   select install_day,max(install) install,source,
		max(case retention_day when 0 then retention_rate else 0 end) D0,
		max(case retention_day when 1 then retention_rate else 0 end) D1,
		max(case retention_day when 2 then retention_rate else 0 end) D2,
		max(case retention_day when 3 then retention_rate else 0 end) D3,
		max(case retention_day when 4 then retention_rate else 0 end) D4,
		max(case retention_day when 5 then retention_rate else 0 end) D5,
		max(case retention_day when 6 then retention_rate else 0 end) D6,
		max(case retention_day when 7 then retention_rate else 0 end) D7,
		max(case retention_day when 8 then retention_rate else 0 end) D8,
		max(case retention_day when 9 then retention_rate else 0 end) D9,
		max(case retention_day when 10 then retention_rate else 0 end) D10,
		max(case retention_day when 11 then retention_rate else 0 end) D11,
		max(case retention_day when 12 then retention_rate else 0 end) D12,
		max(case retention_day when 13 then retention_rate else 0 end) D13,
		max(case retention_day when 14 then retention_rate else 0 end) D14,
		max(case retention_day when 15 then retention_rate else 0 end) D15,
		max(case retention_day when 16 then retention_rate else 0 end) D16,
		max(case retention_day when 17 then retention_rate else 0 end) D17,
		max(case retention_day when 18 then retention_rate else 0 end) D18,
		max(case retention_day when 19 then retention_rate else 0 end) D19,
		max(case retention_day when 20 then retention_rate else 0 end) D20,
		max(case retention_day when 21 then retention_rate else 0 end) D21,
		max(case retention_day when 22 then retention_rate else 0 end) D22,
		max(case retention_day when 23 then retention_rate else 0 end) D23,
		max(case retention_day when 24 then retention_rate else 0 end) D24,
		max(case retention_day when 25 then retention_rate else 0 end) D25,
		max(case retention_day when 26 then retention_rate else 0 end) D26,
		max(case retention_day when 27 then retention_rate else 0 end) D27,
		max(case retention_day when 28 then retention_rate else 0 end) D28,
		max(case retention_day when 29 then retention_rate else 0 end) D29,
		max(case retention_day when 30 then retention_rate else 0 end) D30,
		max(case retention_day when 31 then retention_rate else 0 end) D31,
		max(case retention_day when 32 then retention_rate else 0 end) D32,
		max(case retention_day when 33 then retention_rate else 0 end) D33,
		max(case retention_day when 34 then retention_rate else 0 end) D34,
		max(case retention_day when 35 then retention_rate else 0 end) D35,
		max(case retention_day when 36 then retention_rate else 0 end) D36,
		max(case retention_day when 37 then retention_rate else 0 end) D37,
		max(case retention_day when 38 then retention_rate else 0 end) D38,
		max(case retention_day when 39 then retention_rate else 0 end) D39,
		max(case retention_day when 40 then retention_rate else 0 end) D40,
		max(case retention_day when 41 then retention_rate else 0 end) D41,
		max(case retention_day when 42 then retention_rate else 0 end) D42,
		max(case retention_day when 43 then retention_rate else 0 end) D43,
		max(case retention_day when 44 then retention_rate else 0 end) D44,
		max(case retention_day when 45 then retention_rate else 0 end) D45,
		max(case retention_day when 46 then retention_rate else 0 end) D46,
		max(case retention_day when 47 then retention_rate else 0 end) D47,
		max(case retention_day when 48 then retention_rate else 0 end) D48,
		max(case retention_day when 49 then retention_rate else 0 end) D49,
		max(case retention_day when 50 then retention_rate else 0 end) D50,
		max(case retention_day when 51 then retention_rate else 0 end) D51,
		max(case retention_day when 52 then retention_rate else 0 end) D52,
		max(case retention_day when 53 then retention_rate else 0 end) D53,
		max(case retention_day when 54 then retention_rate else 0 end) D54,
		max(case retention_day when 55 then retention_rate else 0 end) D55,
		max(case retention_day when 56 then retention_rate else 0 end) D56,
		max(case retention_day when 57 then retention_rate else 0 end) D57,
		max(case retention_day when 58 then retention_rate else 0 end) D58,
		max(case retention_day when 59 then retention_rate else 0 end) D59,
		max(case retention_day when 60 then retention_rate else 0 end) D60,
		max(case retention_day when 61 then retention_rate else 0 end) D61,
		max(case retention_day when 62 then retention_rate else 0 end) D62,
		max(case retention_day when 63 then retention_rate else 0 end) D63,
		max(case retention_day when 64 then retention_rate else 0 end) D64,
		max(case retention_day when 65 then retention_rate else 0 end) D65,
		max(case retention_day when 66 then retention_rate else 0 end) D66,
		max(case retention_day when 67 then retention_rate else 0 end) D67,
		max(case retention_day when 68 then retention_rate else 0 end) D68,
		max(case retention_day when 69 then retention_rate else 0 end) D69,
		max(case retention_day when 70 then retention_rate else 0 end) D70,
		max(case retention_day when 71 then retention_rate else 0 end) D71,
		max(case retention_day when 72 then retention_rate else 0 end) D72,
		max(case retention_day when 73 then retention_rate else 0 end) D73,
		max(case retention_day when 74 then retention_rate else 0 end) D74,
		max(case retention_day when 75 then retention_rate else 0 end) D75,
		max(case retention_day when 76 then retention_rate else 0 end) D76,
		max(case retention_day when 77 then retention_rate else 0 end) D77,
		max(case retention_day when 78 then retention_rate else 0 end) D78,
		max(case retention_day when 79 then retention_rate else 0 end) D79,
		max(case retention_day when 80 then retention_rate else 0 end) D80,
		max(case retention_day when 81 then retention_rate else 0 end) D81,
		max(case retention_day when 82 then retention_rate else 0 end) D82,
		max(case retention_day when 83 then retention_rate else 0 end) D83,
		max(case retention_day when 84 then retention_rate else 0 end) D84,
		max(case retention_day when 85 then retention_rate else 0 end) D85,
		max(case retention_day when 86 then retention_rate else 0 end) D86,
		max(case retention_day when 87 then retention_rate else 0 end) D87,
		max(case retention_day when 88 then retention_rate else 0 end) D88,
		max(case retention_day when 89 then retention_rate else 0 end) D89,
		max(case retention_day when 90 then retention_rate else 0 end) D90
	from user_retention_source_ltv 
	<if test="_parameter != null">
		<include refid="Vo_Where_Clause" />
		<![CDATA[ 
				and (retention_day >= 0 and retention_day <= 90) 
			]]>
	</if>
	<if test="searchValue != null">
	    and (install_day like concat('%', #{searchValue}, '%') or source like concat('%', #{searchValue}, '%'))
	 </if>
	 <![CDATA[ 
		group by install_day,source
		order by install_day desc
		limit #{offset},#{rows}
	]]>
</select>

<select id="selectAllRoleRetentionList" parameterType="com.hoolai.bi.report.vo.UserRetentionLtvVO" resultMap="LifeResultMap">
  select a.install_day,b.role_choice as install,a.source,
		max(case a.retention_day when 0 then (a.retention_num / b.role_choice) else 0 end) D0,
		max(case a.retention_day when 1 then (a.retention_num / b.role_choice) else 0 end) D1,
		max(case a.retention_day when 2 then (a.retention_num / b.role_choice) else 0 end) D2,
		max(case a.retention_day when 3 then (a.retention_num / b.role_choice) else 0 end) D3,
		max(case a.retention_day when 4 then (a.retention_num / b.role_choice) else 0 end) D4,
		max(case a.retention_day when 5 then (a.retention_num / b.role_choice) else 0 end) D5,
		max(case a.retention_day when 6 then (a.retention_num / b.role_choice) else 0 end) D6,
		max(case a.retention_day when 7 then (a.retention_num / b.role_choice) else 0 end) D7,
		max(case a.retention_day when 8 then (a.retention_num / b.role_choice) else 0 end) D8,
		max(case a.retention_day when 9 then (a.retention_num / b.role_choice) else 0 end) D9,
		max(case a.retention_day when 10 then (a.retention_num / b.role_choice) else 0 end) D10,
		max(case a.retention_day when 11 then (a.retention_num / b.role_choice) else 0 end) D11,
		max(case a.retention_day when 12 then (a.retention_num / b.role_choice) else 0 end) D12,
		max(case a.retention_day when 13 then (a.retention_num / b.role_choice) else 0 end) D13,
		max(case a.retention_day when 14 then (a.retention_num / b.role_choice) else 0 end) D14,
		max(case a.retention_day when 15 then (a.retention_num / b.role_choice) else 0 end) D15,
		max(case a.retention_day when 16 then (a.retention_num / b.role_choice) else 0 end) D16,
		max(case a.retention_day when 17 then (a.retention_num / b.role_choice) else 0 end) D17,
		max(case a.retention_day when 18 then (a.retention_num / b.role_choice) else 0 end) D18,
		max(case a.retention_day when 19 then (a.retention_num / b.role_choice) else 0 end) D19,
		max(case a.retention_day when 20 then (a.retention_num / b.role_choice) else 0 end) D20,
		max(case a.retention_day when 21 then (a.retention_num / b.role_choice) else 0 end) D21,
		max(case a.retention_day when 22 then (a.retention_num / b.role_choice) else 0 end) D22,
		max(case a.retention_day when 23 then (a.retention_num / b.role_choice) else 0 end) D23,
		max(case a.retention_day when 24 then (a.retention_num / b.role_choice) else 0 end) D24,
		max(case a.retention_day when 25 then (a.retention_num / b.role_choice) else 0 end) D25,
		max(case a.retention_day when 26 then (a.retention_num / b.role_choice) else 0 end) D26,
		max(case a.retention_day when 27 then (a.retention_num / b.role_choice) else 0 end) D27,
		max(case a.retention_day when 28 then (a.retention_num / b.role_choice) else 0 end) D28,
		max(case a.retention_day when 29 then (a.retention_num / b.role_choice) else 0 end) D29,
		max(case a.retention_day when 30 then (a.retention_num / b.role_choice) else 0 end) D30,
		max(case a.retention_day when 31 then (a.retention_num / b.role_choice) else 0 end) D31,
		max(case a.retention_day when 32 then (a.retention_num / b.role_choice) else 0 end) D32,
		max(case a.retention_day when 33 then (a.retention_num / b.role_choice) else 0 end) D33,
		max(case a.retention_day when 34 then (a.retention_num / b.role_choice) else 0 end) D34,
		max(case a.retention_day when 35 then (a.retention_num / b.role_choice) else 0 end) D35,
		max(case a.retention_day when 36 then (a.retention_num / b.role_choice) else 0 end) D36,
		max(case a.retention_day when 37 then (a.retention_num / b.role_choice) else 0 end) D37,
		max(case a.retention_day when 38 then (a.retention_num / b.role_choice) else 0 end) D38,
		max(case a.retention_day when 39 then (a.retention_num / b.role_choice) else 0 end) D39,
		max(case a.retention_day when 40 then (a.retention_num / b.role_choice) else 0 end) D40,
		max(case a.retention_day when 41 then (a.retention_num / b.role_choice) else 0 end) D41,
		max(case a.retention_day when 42 then (a.retention_num / b.role_choice) else 0 end) D42,
		max(case a.retention_day when 43 then (a.retention_num / b.role_choice) else 0 end) D43,
		max(case a.retention_day when 44 then (a.retention_num / b.role_choice) else 0 end) D44,
		max(case a.retention_day when 45 then (a.retention_num / b.role_choice) else 0 end) D45,
		max(case a.retention_day when 46 then (a.retention_num / b.role_choice) else 0 end) D46,
		max(case a.retention_day when 47 then (a.retention_num / b.role_choice) else 0 end) D47,
		max(case a.retention_day when 48 then (a.retention_num / b.role_choice) else 0 end) D48,
		max(case a.retention_day when 49 then (a.retention_num / b.role_choice) else 0 end) D49,
		max(case a.retention_day when 50 then (a.retention_num / b.role_choice) else 0 end) D50,
		max(case a.retention_day when 51 then (a.retention_num / b.role_choice) else 0 end) D51,
		max(case a.retention_day when 52 then (a.retention_num / b.role_choice) else 0 end) D52,
		max(case a.retention_day when 53 then (a.retention_num / b.role_choice) else 0 end) D53,
		max(case a.retention_day when 54 then (a.retention_num / b.role_choice) else 0 end) D54,
		max(case a.retention_day when 55 then (a.retention_num / b.role_choice) else 0 end) D55,
		max(case a.retention_day when 56 then (a.retention_num / b.role_choice) else 0 end) D56,
		max(case a.retention_day when 57 then (a.retention_num / b.role_choice) else 0 end) D57,
		max(case a.retention_day when 58 then (a.retention_num / b.role_choice) else 0 end) D58,
		max(case a.retention_day when 59 then (a.retention_num / b.role_choice) else 0 end) D59,
		max(case a.retention_day when 60 then (a.retention_num / b.role_choice) else 0 end) D60,
		max(case a.retention_day when 61 then (a.retention_num / b.role_choice) else 0 end) D61,
		max(case a.retention_day when 62 then (a.retention_num / b.role_choice) else 0 end) D62,
		max(case a.retention_day when 63 then (a.retention_num / b.role_choice) else 0 end) D63,
		max(case a.retention_day when 64 then (a.retention_num / b.role_choice) else 0 end) D64,
		max(case a.retention_day when 65 then (a.retention_num / b.role_choice) else 0 end) D65,
		max(case a.retention_day when 66 then (a.retention_num / b.role_choice) else 0 end) D66,
		max(case a.retention_day when 67 then (a.retention_num / b.role_choice) else 0 end) D67,
		max(case a.retention_day when 68 then (a.retention_num / b.role_choice) else 0 end) D68,
		max(case a.retention_day when 69 then (a.retention_num / b.role_choice) else 0 end) D69,
		max(case a.retention_day when 70 then (a.retention_num / b.role_choice) else 0 end) D70,
		max(case a.retention_day when 71 then (a.retention_num / b.role_choice) else 0 end) D71,
		max(case a.retention_day when 72 then (a.retention_num / b.role_choice) else 0 end) D72,
		max(case a.retention_day when 73 then (a.retention_num / b.role_choice) else 0 end) D73,
		max(case a.retention_day when 74 then (a.retention_num / b.role_choice) else 0 end) D74,
		max(case a.retention_day when 75 then (a.retention_num / b.role_choice) else 0 end) D75,
		max(case a.retention_day when 76 then (a.retention_num / b.role_choice) else 0 end) D76,
		max(case a.retention_day when 77 then (a.retention_num / b.role_choice) else 0 end) D77,
		max(case a.retention_day when 78 then (a.retention_num / b.role_choice) else 0 end) D78,
		max(case a.retention_day when 79 then (a.retention_num / b.role_choice) else 0 end) D79,
		max(case a.retention_day when 80 then (a.retention_num / b.role_choice) else 0 end) D80,
		max(case a.retention_day when 81 then (a.retention_num / b.role_choice) else 0 end) D81,
		max(case a.retention_day when 82 then (a.retention_num / b.role_choice) else 0 end) D82,
		max(case a.retention_day when 83 then (a.retention_num / b.role_choice) else 0 end) D83,
		max(case a.retention_day when 84 then (a.retention_num / b.role_choice) else 0 end) D84,
		max(case a.retention_day when 85 then (a.retention_num / b.role_choice) else 0 end) D85,
		max(case a.retention_day when 86 then (a.retention_num / b.role_choice) else 0 end) D86,
		max(case a.retention_day when 87 then (a.retention_num / b.role_choice) else 0 end) D87,
		max(case a.retention_day when 88 then (a.retention_num / b.role_choice) else 0 end) D88,
		max(case a.retention_day when 89 then (a.retention_num / b.role_choice) else 0 end) D89,
		max(case a.retention_day when 90 then (a.retention_num / b.role_choice) else 0 end) D90
	from (
	(select * from user_retention_source_ltv 
	<if test="_parameter != null">
		<include refid="Vo_Where_Clause" />
		<![CDATA[ 
				and (retention_day >= 0 and retention_day <= 90) 
			]]>
	</if>
	<if test="searchValue != null">
	    and (install_day like concat('%', #{searchValue}, '%') or source like concat('%', #{searchValue}, '%'))
	 </if>
	 
) a
left outer join
(
	select day,role_choice,source
	from source_daily_report 
    <if test="_parameter != null">
		<include refid="Vo_Where_Clause_daily_report" />
	</if>
) b on a.install_day = b.day and a.source = b.source)
group by install_day,source
order by install_day desc
limit #{offset},#{rows}
</select>

</mapper>